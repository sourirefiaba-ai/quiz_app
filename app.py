# Flaskというライブラリを読み込む
from flask import Flask, render_template, request, redirect, url_for, session
import random

# Flaskアプリのインスタンスを作成 	Flaskアプリの本体を作る
app = Flask(__name__)

app.secret_key = "super_secret_key"  # セッション用

quiz_data = {
    "トピック 1: 組織割当およびプロセス統合": [
        # 問題 1
        {
            "question": "会社では、売上原価会計に従って損益計算書が構成されています。どの組織ユニットを定義する必要がありますか。",
            "choices": ["事業領域", "セグメント", "利益センタ", "機能領域"],
            "answer": "機能領域"
        },

        # 問題 2
        {
            "question": "新たに登録した3つの会社コードを同じ管理領域に割り当てようとしています。すべての会社コードで共通である必要がある設定はどれですか。（2つ選択）",
            "choices": ["グループ通貨の元通貨", "運用勘定コード表", "会計年度バリアント", "会計期間バリアント"],
            "answer": ["運用勘定コード表", "会計年度バリアント"]
        },

        # 問題 3
        {
            "question": "会社はフランスに拠点を置いていますが、法律で財務諸表が要求されているスイスに恒久的施設があります。スイスの恒久的施設に登録する必要がある組織ユニットはどれですか。",
            "choices": ["事業領域", "会社コード", "利益センタ", "セグメント"],
            "answer": "会社コード"
        },

        # 問題 4
        {
            "question": "SAP S/4HANA でデフォルト設定されている通貨タイプはどれですか。 （２つ選択）",
            "choices": ["10 = 会社コード通貨", "30 = グループ通貨", "20 = 管理領域通貨", "00 = 伝票通貨"],
            "answer": ["10 = 会社コード通貨", "00 = 伝票通貨"]
        },

        # 問題 5
        {
            "question": "得意先の前受金が販売管理（SD）で処理される過程を的確に説明している文は次のどれですか。",
            "choices": [
                "前受金請求が Fl 備忘明細として登録された後、SD 受注が自動生成される。",
                "前受金請求が Fl 備忘明細として登録された後、SD 請求伝票が自動生成される。",
                "前受金請求が SD 受注として登録された後、備忘明細として Fl に自動的に転記される。",
                "前受金請求が SD 請求伝票として登録された後、備忘明細として Fl に自動的に転記される。"
            ],
            "answer": "前受金請求が SD 受注として登録された後、備忘明細として Fl に自動的に転記される。"
        },

        # 問題 6
        {
            "question": "SAP S/4HANA に購買発注見越を実装する必要があります。以下のユースケースのうち、どれが関連しますか。 （２つ選択）",
            "choices": ["サービスの購入", "消費品目の購入", "在庫の原材料の購入", "固定資産の購入 (直接資本化方式を使用)"],
            "answer": ["サービスの購入", "消費品目の購入"]
        },

        # 問題 7
        {
            "question": "連結準備を直接サポートするために使用されるオブジェクトはどれですか。",
            "choices": ["機能領域", "会社/取引パートナ", "元帳/元帳グループ", "セグメント/利益センタ"],
            "answer": "会社/取引パートナ"
        },

        # 問題 8
        {
            "question": "あなたの会社は IFRS 会計原則に従い、\"消費財\" と \"プロフェッショナル製品\" の 2つの主要部門について、完全な財務諸表を発行する必要があります。このシナリオでセグメントレポートを実現するために必要なものは何ですか。 （３つ選択）",
            "choices": ["収益性セグメント", "事業領域", "セグメント", "利益センタ", "伝票分割"],
            "answer": ["セグメント", "利益センタ", "伝票分割"]
        },

        # 問題 9
        {
            "question": "以下のうち、複数の会社コードで共有できる組織要素はどれですか。 （３つ選択）",
            "choices": ["販売組織", "プラント", "事業領域", "利益センタ", "セグメント"],
            "answer": ["事業領域", "利益センタ", "セグメント"]
        },

        # 問題 10
        {
            "question": "SAP S/4HANA では、唯一の正しい情報源を表すユニバーサルジャーナル (テーブル ACDOCA) が導入されました。テーブル ACDOCA にはどの明細が記録されていますか。 （３つ選択）",
            "choices": ["会社間転記", "付替によって発生する一次原価", "配賦によって発生する二次原価", "原価センタの予算原価", "計画償却額"],
            "answer": ["会社間転記", "付替によって発生する一次原価", "配賦によって発生する二次原価"]
        },
        # 問題 11
        {
            "question": "SAP S/4HANA システムで、どの会社コードでも使用されなくなった業務の G/L勘定をアーカイブする必要があります。 G/L勘定のすべてのデータをアーカイブするための前提条件は、次のうちどれですか。 （３つ選択）",
            "choices": [
             "勘定が自動勘定設定で使用されない。",
             "勘定に取引金額が存在しない。",
             "G/L勘定の勘定コード表データに削除フラグを設定する。",
             "取引金額が、カスタマイズ可能な年数よりも古い。",
             "G/L勘定の会社コードデータに削除フラグを設定する。"
            ],
            "answer": [
             "勘定に取引金額が存在しない。",
             "G/L勘定の勘定コード表データに削除フラグを設定する。",
             "G/L勘定の会社コードデータに削除フラグを設定する。"
            ]
        },

        # 問題 12
        {
            "question": "以下のうち、特定の元帳に対して定義できる通貨タイプはどれですか。 （３つ選択）",
            "choices": [
             "00 = 伝票通貨",
             "10 = 会社コード通貨",
             "30 = グループ通貨",
             "40 = ハード通貨",
             "60 = グローバル会社通貨"
         ],
            "answer": [
             "30 = グループ通貨",
             "40 = ハード通貨",
             "60 = グローバル会社通貨"
         ]
        },

        # 問題 13
        {
            "question": "財務会計で代入を定義します。代入の各ステップに対して、次のどのパーツを定義する必要がありますか。 （２つ選択）",
            "choices": [
                "代入地",
                "前提条件",
                "呼び出し位置",
                "チェック明細"
            ],
            "answer": [
                "代入地",
                "前提条件"
            ]
        },

        # 問題 14
        {
            "question": "機能領域はどのレベルで定義しますか。",
            "choices": [
                "管理領域",
                "クライアント",
                "会社コード",
                "財務諸表バージョン"
            ],
            "answer": "クライアント"
        }
    ],

    "トピック 2: 総勘定元帳": [
        # 問題 15
        {
            "question": "伝票の入力ビューで、総勘定元帳ビューよりも明細の数が少ないことに気付きました。どのような理由が考えられますか。",
            "choices": [
                "追加加元帳が設定されている。",
                "売上税が総勘定元帳ビューの詳細に転記されている。",
                "補助元帳勘定が総勘定元帳ビューの詳細に表示されている。",
                "伝票分割が有効化されている。"
            ],
            "answer": "伝票分割が有効化されている。"
        },

        # 問題 16
        {
            "question": "会社コードの一般仕訳を転記しています。エントリを転記した後、伝票番号が誤った番号範囲にあることに気付きました。伝票を反対仕訳した後、伝票の再転記時に何を変更する必要がありますか。",
            "choices": ["伝票タイプ", "転記キー", "ソートキー", "伝票番号"],
            "answer": "伝票タイプ"
        },

        # 問題 17
        {
            "question": "税計算表を設定する必要があります。定義する必要のある主な要素は何ですか。(3つ選択)",
            "choices": ["勘定キー", "税コード", "ステップ順序", "税カテゴリ", "条件タイプ"],
            "answer": ["勘定キー", "ステップ順序", "条件タイプ"]
        },

        # 問題 18
        {
            "question": "リーディング元帳が他のパラレル標準元帳と異なる点は何ですか。",
            "choices": [
                "すべての会社コードに割り当てられている。",
                "他の元帳から金額が導出できない。",
                "グループ評価を表すために使用される。",
                "セグメントレポートの実行に使用される。"
            ],
            "answer": "すべての会社コードに割り当てられている。"
        },

        # 問題 19
        {
            "question": "二つの通貨間の外貨換算比率はどのレベルで更新しますか",
            "choices": ["評価タイプ", "換算レートタイプ", "伝票タイプ", "通貨タイプ"],
            "answer": "換算レートタイプ"
        },

        # 問題 20
        {
            "question": "自動消込プログラムによって消し込まれない明細は次のうちどれですか(３つ選択)",
            "choices": [
                "消費税のある明細",
                "統計転記",
                "売上税と使用税のある明細",
                "源泉徴収税のある明細",
                "備忘明細"
            ],
            "answer": ["統計転記", "源泉徴収税のある明細", "備忘明細"]
        },
        
        # 問題 21
        {
            "question_number": 21,
            "question": "G/L勘定に対して明細消込管理を無効化するための前提条件はなんですか。",
            "choices": [
                "転記されていない",
                "貸借が一致する",
                "転記に対してブロックされている",
                "未消込明細がない"
            ],
            "answer": "貸借が一致する"
        },

        # 問題 22
        {
            "question_number": 22,
            "question": "代替勘定を G/L 勘定に割り当てようとしていますが、エラーメッセージが表示されます。どのような理由が考えられますか。",
            "choices": [
                "代替勘定コード表を会社に割り当てていない。",
                "会社コードに対して代替勘定が登録されていない。",
                "代替勘定が、会社コードの別のG/L 勘定にすでに割り当てられている。",
                "代替勘定コード表を運用勘定コード表に割り当てていない。"
            ],
            "answer": "代替勘定が、会社コードの別のG/L 勘定にすでに割り当てられている。"
        },

        # 問題 23
        {
            "question_number": 23,
            "question": "G/L 勘定を登録しようとしていますが、勘定コードが許容範囲外であるため、エラーが発生します。番号範囲を拡張するには、どのオブジェクトをカスタマイズする必要がありますか。",
            "choices": [
                "許容範囲グループ",
                "勘定タイプ",
                "勘定グループ",
                "勘定コード表"
            ],
            "answer": "勘定グループ"
        },

        # 問題 24
        {
            "question_number": 24,
            "question": "グループ勘定コード表はどこで割り当てますか",
            "choices": [
                "会社コード",
                "会社",
                "G/L勘定",
                "運用勘定コード表"
            ],
            "answer": "運用勘定コード表"
        },

        # 問題 25
        {
            "question_number": 25,
            "question": "G/L 勘定の勘定コード表レベルで更新される項目はどれですか(3つ選択)",
            "choices": [
                "グループ勘定コード",
                "項目ステータスグループ",
                "テキスト(短)",
                "代替勘定コード",
                "勘定グループ"
            ],
            "answer": ["グループ勘定コード", "テキスト(短)", "勘定グループ"]
        },

        # 問題 26
        {
            "question_number": 26,
            "question": "G/L 勘定を新規会社コードに拡張しようとしていますが、データが不完全でエラーが発生します。カスタマイズ可能な全ての項目が、項目ステータスで任意入力に設定されています。G/L勘定の拡張時に常に更新する必要がある項目はどれですか。(2つ選択)",
            "choices": [
                "勘定通貨",
                "項目ステータスグループ",
                "ソートキー",
                "勘定コード"
            ],
            "answer": ["勘定通貨", "項目ステータスグループ"]
        },

        # 問題 27
        {
            "question_number": 27,
            "question": "伝票分割の設定を担当しています。重要な設定は何ですか(二つ選択)",
            "choices": [
                "取引バリアント",
                "伝票タイプ",
                "伝票番号範囲",
                "項目ステータスバリアント"
            ],
            "answer": ["取引バリアント", "伝票タイプ"]
        },

        # 問題 28
        {
            "question_number": 28,
            "question": "新しい標準元帳を定義するときに、一般仕訳をマニュアルで転記するには、以下のどのアクションを実行する必要がありますか。",
            "choices": [
                "元帳に会社コードを割り当てる",
                "基本元帳を定義する",
                "勘定コード表を元帳に割り当てる",
                "元帳グループに元帳を含める"
            ],
            "answer": "元帳に会社コードを割り当てる"
        },

        # 問題 29
        {
            "question_number": 29,
            "question": "損益計算書 (P&L) に値が表示されるのは、どの G/L勘定タイプですか。(3つ選択)",
            "choices": [
                "営業外費用または収入",
                "二次原価",
                "一次原価または収益",
                "貸借対照表勘定",
                "現金勘定"
            ],
            "answer": ["営業外費用または収入", "二次原価", "一次原価または収益"]
        },

        # 問題 30
        {
            "question_number": 30,
            "question": "会計年度バリアントは何を定義しますか(二つ選択)",
            "choices": [
                "会計期間の開始日付と終了日付",
                "会計期間数",
                "転記可能な会計期間",
                "特別会計期間への転記権限"
            ],
            "answer": ["会計期間の開始日付と終了日付", "会計期間数"]
        },

        # 問題 31
        {
            "question_number": 31,
            "question": "通貨タイプはどこで割り当てますか",
            "choices": [
                "会社",
                "評価領域",
                "会計原則",
                "元帳"
            ],
            "answer": "元帳"
        },

        # 問題 32
        {
            "question_number": 32,
            "question": "クローズされた会計期間に転記された伝票の反対仕訳を転記しようとしています。オリジナル伝票とは異なる日付で反対仕訳を入力できるようにするには、どのオブジェクトを設定しますか。",
            "choices": [
                "会社コード",
                "反対仕訳方法",
                "伝票タイプ",
                "反対仕訳理由"
            ],
            "answer": "反対仕訳理由"
        },

        # 問題 33
        {
            "question_number": 33,
            "question": "15の法人組織で構成される企業グループの連結財務レポートを準備します。SAP S/4HANA システムで1つのクライアントに10の会社コードが定義されています。その他については、個別のレガシーシステムが使用されます。連結シナリオに対応するには、SAP S/4HANAシステムでいくつの会社を定義する必要がありますか。",
            "choices": [
                "15",
                "5",
                "10",
                "1"
            ],
            "answer": "15"
        }  
    ],

    "トピック 3: 債務管理および債権管理": [    
        # 問題 34
        {   "question_number": 34,
            "question": "得意先未消込明細を消し込みましたが、 このアクションを取り消そうとしています。 利用可能なオプションは何ですか。(2つ選択)",
            "choices": ["消込伝票の反対仕訳", "消込伝票のリセット", "消込伝票のリセットおよび反対仕訳", "消込伝票の再転記"],
            "answer": ["消込伝票のリセット", "消込伝票のリセットおよび反対仕訳"]

        },

        # 問題 35
        {   "question_number": 35,
            "question": "SAP S/4HANA における備忘明細のコンセプトについて説明する必要があります。 備忘明細に固有の特性はどれですか。(3つ選択)",
            "choices": ["支払プログラムと督促プログラムによってアクセスすることができる。","入力ビューでのみ総勘定元帳を更新する。","貸借が一致しない転記を生成する。","得意先コードおよび仕入先コードの未消込明細として管理される。","統計転記を生成する。"],
            "answer": ["支払プログラムと督促プログラムによってアクセスすることができる。","貸借が一致しない転記を生成する。","得意先コードおよび仕入先コードの未消込明細として管理される。"]
        },

        # 問題 36
        {   "question_number": 36,
            "question": "債権管理では理由コードを使用して何を制御しますか(3つ選択)",
            "choices": ["前受/前払金の特殊仕訳コード","残余明細が転記される勘定","得意先に送付される支払通知のタイプ","クレームを受けた残余明細を与信限度チェックから除外","支払の伝票番号"],
            "answer": ["残余明細が転記される勘定","得意先に送付される支払通知のタイプ","クレームを受けた残余明細を与信限度チェックから除外"]
        },

        # 問題 37
        {   "question_number": 37,
            "question": "3方向照合は、S/4HANA で調達取引を転記するために使用される標準手順です。 どのように動作しますか。",
            "choices": ["転記日付","入庫日付","入力日付","起算日","伝票日付"],
            "answer": ["転記日付","入力日付","伝票日付"]
        },

        # 問題 38
        {   "question_number": 38,
            "question": "得意先の前受金が販売管理（SD）で処理される過程を的確に説明している文は次のどれですか。",
            "choices": ["入庫は、購買発注を参照して登録する必要がある。","購買発注は、購買依頼を参照して登録する必要がある。","3つのロジスティクスステップごとに財務伝票が生成される。","請求書は、入庫を参照して登録する必要がある。"],
            "answer": "入庫は、購買発注を参照して登録する必要がある。"
        },
        # 問題 39
        {   "question_number": 39,
            "question": "支払方法を定義します。 会社コードのレベルではどのパラメータを定義しますか。(2つ選択)",
            "choices": ["支払媒体" ,"使用可能通貨" ,"最低支払額と最高支払額" ,"外貨支払可能"],
            "answer": ["最低支払額と最高支払額" ," 外貨支払可能"]
        },

        # 問題 40
        {   "question_number": 40,
            "question": "得意先との間で金額 EUR 10000 の保証について同意しました。この保証を SAP S/4HANA に記録すると、 どのような結果になりますか。",
            "choices": ["2つの備忘明細" ," 1つの統計明細" ," 2つの統計明細" ," 1つの備忘明細"],
            "answer": "2つの統計明細"
        },

        # 問題 41
        {   "question_number": 41,
            "question": "ビジネスパートナーマスタレコードで更新する督促関連データは何ですか(2つ選択)",
            "choices": ["督促保留" ," 督促領域" ," 督促間隔日数" ," 督促キー"],
            "answer": ["督促保留" ," 督促領域"]
        },

        # 問題 42
        {   "question_number": 42,
            "question": "支払差額の残余明細を使用して、得意先からの入金を転記します。結果はどのようになりますか。(2つ選択)",
            "choices": ["残余明細が原価勘定に欠損処理される。" ,"元の未消込明細と残余明細の両方が、 未消込明細として勘定に残る。" ,"残余明細が新規売掛金になる。" ,"元の伝票と入金が消し込まれる。"],
            "answer": ["残余明細が新規売掛金になる。" ,"元の伝票と入金が消し込まれる。"]
        },

        # 問題 43
        {   "question_number": 43,
            "question": "標準販売プロセスにおいて、 COGS (cost of goods sold) 転記が財務会計で生成されるのはいつですか。",
            "choices": ["PGI 実行(出庫転記)" ,"得意先請求書の発行" ,"請求伝票の登録" ,"出荷伝票の登録"],
            "answer": "PGI 実行(出庫転記)"
        },

        # 問題 44
        {   "question_number": 44,
            "question": "督促レベルで設定できるパラメータはどれですか。(2つ選択)",
            "choices": ["延滞日数" ,"金利フラグ" ,"支払期日までの日数" ,"明細毎猶予日数"],
            "answer": ["延滞日数" ,"支払期日までの日数"]
        },


        # 問題 45
        {   "question_number": 45,
            "question": "支払が必要な請求書の入力時には、どの日付が設定される必要がありますか",
            "choices": ["参照日付" ,"支払日" ,"支払基準日" ,"受注日付"],
            "answer": "支払基準日"
        },

        # 問題 46
        {   "question_number": 46,
            "question": "SAP S/4HANA システムにおける督促処理の3つの必須ステップは何ですか。(3つ選択)",
            "choices": ["督促処理実行をスケジュールする" ,"督促提案を承認する" ,"督促提案を変更する" ,"督促プログラムのパラメータを更新する" ,"督促状印刷を開始する"],
            "answer": ["督促処理実行をスケジュールする","督促プログラムのパラメータを更新する","督促状印刷を開始する"]
        },


        # 問題 47
        {   "question_number": 47,
            "question": "財務会計でクレジットメモを入力しようとしていますが、 入力した支払条件が無視される理由が不明です。 その理由は何ですか。(2つ選択)",
            "choices": ["入力された支払条件に基づいて決定された期日が過去の日付です。" ,"クレジットメモの「参照」項目が空白になっている。" ,"クレジットメモが請求書を参照せずに登録された。" ,"クレジットメモが財務会計に入力された。"],
            "answer": ["クレジットメモの「参照」項目が空白になっている。" ,"クレジットメモが請求書を参照せずに登録された。"]
        },

        # 問題 48
        {   "question_number": 48,
            "question": "連絡文書タイプに対して、次のどのレベルで印刷プログラムおよびそのバリアントを割り当てることができますか。(2つ選択)",
            "choices": ["会社コード" ,"システム" ,"クライアント" ,"会社"],
            "answer": ["会社コード","クライアント"]
        },

        # 問題 49
        {   "question_number": 49,
            "question": "新しい連絡文書タイプの設定時に指定できるパラメータは次のどれですか。(3つ選択)",
            "choices": ["必要な日付項目の数" ,"必須の会社コード" ,"必須の勘定" ,"必須の理由コード" ,"必須の伝票番号"],
            "answer": ["必要な日付項目の数" ,"必須の勘定","必須の伝票番号"]
        },


        # 問題 50
        {   "question_number": 50,
            "question": "複数の会社コードを1つの支払処理に含めようとしています。 会社コードの前提条件は何ですか。",
            "choices": ["支払取引の設定が同じである必要がある。","同じ管理領域に属している必要がある。","同じ国に存在する必要がある。","すべて同じ会社に属している必要がある。"],
            "answer": "同じ国に存在する必要がある。"
        },

        # 問題 51
        {   "question_number": 51,
            "question": "債権と債務を再グループ化するために、何を設定しますか",
            "choices": ["ソート方法" ,"計算方法" ,"引当方法" ,"評価方法"],
            "answer": "ソート方法"
        },
    ],  
 
   "トピック 4: 固定資産管理": [
       # 問題 52
       {   "question_number": 52,
           "question": "会社コードに対して残高繰越を実行します。 ログを確認すると、固定資産に関するエラーが表示されています。 このエラーの原因は何ですか。",
           "choices": ["建設仮勘定の決済を実行していない。" ,"不完全な資産マスタレコードがある。" ,"前会計年度をクローズしていない。" ,"減価償却が完全に転記されていない。"],
           "answer": "前会計年度をクローズしていない。"
       },


       # 問題 53
       {   "question_number": 53,
           "question": "1つの資産の減価償却費を2つの原価センタに転記しようとしています。この処理をどのように実行しますか。",
           "choices": ["資産マスタデータに実際の原価センタと統計原価センタを割り当てる。","資産マスタデータに2つの実際の原価センタを割り当てる。","資産マスタデータに、 2つの原価センタに定期的に決済する実績内部指図を割り当てる。","資産マスタデータに、 2つの原価センタに定期的に決済する統計指図を割り当てる。"],
           "answer": "資産マスタデータに、 2つの原価センタに定期的に決済する実績内部指図を割り当てる。"
       },


       # 問題 54
       {   "question_number": 54,
           "question": "パラメータ「貸借対照表」 および 「一致」 が有効な固定資産管理の勘定割当として、(設備予算管理に関連しない) WBS 要素を有効化しました。 結果はどのようになりますか。(2つ選択)",
           "choices": ["資産マスタデータの WBS 要素は、計画償却記帳時に変更することができる。", "WBS 要素は決済に使用できなくなる。","WBS 要素は、資産マスタレコードに入力することができる。","資産が資本化されると、 資産マスタレコードでWBS 要素を変更できなくなる。"],
           "answer": ["WBS 要素は、資産マスタレコードに入力することができる。" ,"資産が資本化されると、 資産マスタレコードでWBS 要素を変更できなくなる。"]
       },


       # 問題 55
       {   "question_number": 55,
           "question": "償却領域 01 の特性は何ですか。(2つ選択)",
           "choices": ["常にリアルタイムで転記する必要がある。" ,"他の領域から値を引き継ぐことはできない。" ,"原価計算評価領域タイプとして定義されている必要がある。" ,"リーディング元帳 OL にリンクされている必要がある。"],
           "answer": ["常にリアルタイムで転記する必要がある。" ,"他の領域から値を引き継ぐことはできない。"]
       },


       # 問題 56
       {   "question_number": 56,
           "question": "カスタマイジングで統合資産取得の技術消込勘定を定義します。 どの前提条件を満たす必要がありますか。(2つ選択)",
           "choices": ["勘定が各資産クラスの勘定設定で定義されている。" ,"勘定が貸借対照表勘定である。" ," 勘定が固定資産に対する統制勘定として定義されている。" ,"勘定が未消込明細管理勘定として定義されている。"],
           "answer": [" 勘定が貸借対照表勘定である。" ," 勘定が固定資産に対する統制勘定として定義されている。"]
       },

       # 問題 57
       {   "question_number": 57,
           "question": "カスタマイジングで統合資産取得の技術消込勘定を定義します。 どの前提条件を満たす必要がありますか。(2つ選択)",
           "choices": ["勘定が各資産クラスの勘定設定で定義されている。" ,"勘定が貸借対照表勘定である。" ,"勘定が固定資産に対する統制勘定として定義されている。" ,"勘定が未消込明細管理勘定として定義されている。"],
           "answer": ["勘定が貸借対照表勘定である。" ,"勘定が固定資産に対する統制勘定として定義されている。"]
       },

       # 問題 58
       {   "question_number": 58,
           "question": "固定資産管理でトランザクション AS91 を使用してレガシーデータを転送すると、何を実現できますか。",
           "choices": ["マスタデータの登録","G/Lで集計の欠損を転記する" ,"レガシーデータ転送の会社コードステータスの設定" ,"取込価額の転記"],
           "answer": "マスタデータの登録"
       },

       # 問題 59
       {   "question_number": 59,
           "question": "システムでパラレル通貨が使用されています。 パラレル通貨の償却領域の転記区分は何ですか。",
           "choices": ["G/Lへのリアルタイム転記" ,"G/Lへの転記なし" ,"APC をリアルタイムで、 減価償却を定期的に転記" ,"G/Lへの定期転記"],
           "answer": "G/Lへの転記なし"       
        },


       # 問題 60
       {   "question_number": 60,
           "question": "SAP S/4HANA で建設仮勘定をどのように使用するのかを説明するように求められました。 何を強調すればよいですか。(2つ選択)",
           "choices": ["建設仮勘定を完全に資本化した後でも、クレジットメモを転記できる。" ,"貸借対照表の償却領域で、 建設仮勘定に対して減価償却の計算と記帳を実行できる。" ,"建設仮勘定を設備予算管理とともに使用することはできない。" ,"建設仮勘定に対する特別税償却と投資援助を転記できる。"],
           "answer": ["建設仮勘定を完全に資本化した後でも、クレジットメモを転記できる。","建設仮勘定に対する特別税償却と投資援助を転記できる。"]
       },


       # 問題 61
       {   "question_number": 61,
           "question": "カスタマイジングでは、統合資産取得の技術消込勘定をどのレベルで定義できますか。(2つ選択)",
           "choices": ["資産クラス" ,"勘定設定" ,"勘定コード表" ,"償却領域"],
           "answer": ["勘定設定" ,"勘定コード表"]
       },


       # 問題 62
       {   "question_number": 62,
           "question": "カスタマイジングでは、統合資産取得の技術消込勘定をどのレベルで定義できますか。(2つ選択)",
           "choices": ["資産クラス" ,"勘定設定" ,"勘定コード表" ,"償却領域"],
           "answer": ["勘定設定" ,"勘定コード表"]
       },

       # 問題 63
       {   "question_number": 63,
           "question": "償却開始日を決定するには、次のどの日付を使用しますか。",
           "choices": ["支払基準日" ,"資產評価日" ,"転記日付" ,"取得日"],
           "answer": "資產評価日"
       },

       # 問題 64
       {   "question_number": 64,
           "question": "技術消込勘定はどのシナリオで転記されますか。(2つ選択)",
           "choices": ["仕入先請求書 (購買発注にリンクされていない) のある直接資産取得転記" ,"建設仮勘定に対する設備投資指図の決済" ,"資産クラス間の資産振替転記" ,"勘定設定として資産を使用した購買発注の評価入庫"],
           "answer": ["仕入先請求書 (購買発注にリンクされていない) のある直接資産取得転記" ,"勘定設定として資産を使用した購買発注の評価入庫"]
       },

       # 問題 65
       {   "question_number": 65,
           "question": "次のオブジェクトのうち、 資産に原価転記する唯一の統計勘定割当はどれですか。",
           "choices": ["WBS 要素","内部指図" ,"原価センタ" ,"利益センタ"],
           "answer": "利益センタ"
       },

       # 問題 66
       {   "question_number": 66,
           "question": "臨時償却資産に転記します。 FI-AA および FI-GL にはどのような影響がありますか。",
           "choices": ["転記はリアルタイムでFI-AAに行われ、 定期記帳プログラムが実行されると FI-GL に転記が行われる。" ,"転記はリアルタイムでFI-AAに行われ、償却記帳プログラムが実行されると FI-GL に転記が行われる。" ,"転記が FI-AA および FI-GL にオンラインかつリアルタイムで行われる。" ,"償却記帳プログラムが実行されまで、 FI-AA および FI-GL に転記は実行されない。"],
           "answer": "転記はリアルタイムでFI-AAに行われ、償却記帳プログラムが実行されると FI-GL に転記が行われる。"
       },


       # 問題 67
       {
           "question_number": 67,
           "question": "少額資産 (LVA) 管理を設定する必要があります。 必要な作業は何ですか。OLVA の最小金額を3つのレベル (会社コード、 償却領域、 資産クラス) で設定する。",
           "choices": ["LVA の最小金額を3つのレベル (会社コード、 償却領域、 資産クラス) で設定する。","個別管理で LVA の基本数量単位を定義する。","個別管理または集合管理を使用してLVA を管理するため、 2つの異なる資産クラスを定義する。","OLVA の最大金額を2つのレベル(会社コードおよび償却表) で設定する。"],
           "answer": "個別管理または集合管理を使用してLVA を管理するため、 2つの異なる資産クラスを定義する。"
       },


       # 問題 68
       {   "question_number": 68,
           "question": "資産に対して償却記帳を実行します。 特定の資産について、減価償却費を資産マスタデータで指定された原価センタとは異なる原価センタに転記する必要があります。 これをどのようにして実現しますか。",
           "choices": ["LVA の最小金額を3つのレベル(会社コード、 償却領域、資産クラス) で設定する。" ,"個別管理でLVA の基本数量単位を定義する。" ,"個別管理または集合管理を使用してLVA を管理するため、 2つの異なる資産クラスを定義する。" ,"LVA の最大金額を2つのレベル(会社コードおよび償却表) で設定する。"],
           "answer": "財務会計明細で代入を登録する。"
       },


       # 問題 69
       {   "question_number": 69,
           "question": "購買発注を参照せずに、資産取得の仕入先請求書を転記します。どの会計伝票が生成されますか。",
           "choices": ["会計原則ごとに1つの伝票" ,"会計原則ごとに個別の伝票" ,"すべての会計原則に対して1つの伝票" ,"会計原則ごとに1つの伝票、すべての会計原則に対して1つの伝票"],
           "answer": "会計原則ごとに1つの伝票、すべての会計原則に対して1つの伝票"
       },
    ],
   
    "トピック 5: 決算処理": [
       # 問題 70
       {   "question_number": 70,
           "question": "決算前の活動として、選択したサプライヤが残高を確認します。 不一致がある場合にのみ応答を期待する場合、 どの確認手順を使用しますか。",
           "choices": ["残高確認書" ,"残高通知" ,"勘定報告書" ,"残高照会時に連絡文書依頼"],
           "answer": "残高通知"
       },
       
       # 問題 71
       {   "question_number": 71,
           "question": "会社間マッチングおよび照合 (ICMR) をどのように定義しますか。(2つ選択)",
           "choices": ["セントラルファイナンスのシステム間の取引マッチングを容易にするソリューションである。" ,
                       "グループレポートと統合できるソリューションである。" ,
                       "SAP S/4HANA コアに組み込まれたソリューションである。" ,
                       "SAP Group Reporting Data Collection の並列実装を必要とする。ソリューションである。"],
           "answer": ["グループレポートと統合できるソリューションである。","SAP S/4HANA コアに組み込まれたソリューションである。"]
       },
              
       # 問題 72
       {   "question_number": 72,
           "question": "あなたの会社では、SAP Intercompany Matching and Reconciliation(ICMR) について聞いたことがあり、ニーズに対応できるかどうか疑問に思っています。 ICMR はどの目的に役立ちますか。(2つ選択)",
           "choices": ["設定されたルールに基づいて会社間収益および原価の消去をトリガするため" ,
                       "ワークフローをトリガする会社間データの不一致を強調表示して解決するため" ,
                       "会社間不一致を修正するための自動転記を生成するため" ,
                       "会社間 AR/AP 残高の自動消去を生成するため"],
           "answer": ["ワークフローをトリガする会社間データの不一致を強調表示して解決するため","会社間不一致を修正するための自動転記を生成するため"]
       },
       
       # 問題 73
       {   "question_number": 73,
           "question": "特別会計期間に仕訳を転記します。 次のどの条件を満たす必要がありますか。(2つ選択)",
           "choices": ["新会計年度への残高繰越が行われている必要がある。" ,
                       "転記するためには会計期間の管理で最後の会計期間をオープンする必要がある。" ,
                       "最後の会計期間に転記日付を入力する必要がある。" ,
                       "転記するためには会計期間の管理で特別会計期間をオープンする必要がある。"],
           "answer": ["最後の会計期間に転記日付を入力する必要がある。","転記するためには会計期間の管理で特別会計期間をオープンする必要がある。"]
       },       
       
       # 問題 74
       {   "question_number": 74,
           "question": "会社間マッチングおよび照合ツールからのマッチング結果は、 どこで確認できますか。",
           "choices": ["連結仕訳帳テーブル (ACDOCU)" ,
                       "会計伝票セグメントテーブル (BSEG)" ,
                       "アプリケーション固有テーブル (ICADOCM)" ,
                       "ユニバーサルジャーナルテーブル (ACDOCA)"],
           "answer": "アプリケーション固有テーブル (ICADOCM)"
       },       
       
       # 問題 75
       {   "question_number": 75,
           "question": "外貨評価時に考慮される明細はどれですか。(2つ選択)",
           "choices": ["明細消込管理として定義されている貸借対照表勘定の明細評価" ,
                       "明細消込管理として定義されていない貸借対照表勘定の明細の残高評価" ,
                       "元帳グループ固有の明細消込管理を使用して定義された貸借対照表勘定の明細の残高評価" ,
                       "統制勘定として定義されていない貸借対照表勘定の明細評価"],
           "answer": ["明細消込管理として定義されている貸借対照表勘定の明細評価","明細消込管理として定義されていない貸借対照表勘定の明細の残高評価"]
       },       
       
       # 問題 76
       {   "question_number": 76,
           "question": "SAP S/4HANA で使用できる実地棚卸方式はどれですか。(3つ選択)",
           "choices": ["実在庫方式" ,
                       "標準在庫方式" ,
                       "継続棚卸方式" ,
                       "循環棚卸方式",
                       "定期棚卸方式"],
           "answer": ["継続棚卸方式" ,"循環棚卸方式","定期棚卸方式"]
       },       
       
       # 問題 77
       {   "question_number": 77,
           "question": "SAP S/4HANA の追加元帳の説明として最も適切な文は次のどれですか。",
           "choices": ["複数の追加元帳から同じ基本元帳を参照できる。" ,
                       "追加元帳に独自の会計期間バリアントを割当できる。" ,
                       "追加元帳に独自の会計年度バリアントを割当できる。" ,
                       "追加元帳では、基本元帳とは異なる通貨を使用できる。",],
           "answer": ["複数の追加元帳から同じ基本元帳を参照できる。" ,"追加元帳に独自の会計期間バリアントを割当できる。"]
       },       
       
       # 問題 78
       {   "question_number": 78,
           "question": "外貨評価における評価方法の役割は何ですか。(3つ選択)",
           "choices": ["評価転記の転記日付および反対仕訳日付を定義する。" ,
                       "評価転記の伝票タイプを定義する。" ,
                       "評価手順を定義する" ,
                       "評価転記のG/L 勘定を決定する。",
                       "換算レートタイプを決定する。"],
           "answer": ["評価転記の伝票タイプを定義する。" ,"評価手順を定義する","換算レートタイプを決定する。"]
       },       
       
       # 問題 79
       {   "question_number": 79,
           "question": "仕入先勘定の未消込明細に対して外貨評価を実行します。 この外貨評価は期末処理レポートのみに使用した後、 取り消す必要があります。評価差額を転記するために、 次のどの勘定が使用されますか。",
           "choices": ["仕入先統制勘定" ,
                       "特殊仕訳コードがある個別仕入先勘定" ,
                       "外貨の調整 G/L 勘定" ,
                       "代替統制勘定",],
           "answer": "外貨の調整 G/L 勘定"
       },       
       
       # 問題 80
       {   "question_number": 80,
           "question": "会計期間バリアントを使用して転記を制限できるのは、どのレベルですか。(2つ選択)",
           "choices": ["固定資産番号" ,
                       "仕入先勘定" ,
                       "得意先統制勘定" ,
                       "G/L 勘定",],
           "answer": ["得意先統制勘定" , "G/L 勘定",]
       },       
       
       # 問題 81
       {   "question_number": 81,
           "question": "入庫 / 請求仮勘定の貸借が一致していません。 考えられる原因として、\正しいものはどれですか。(2つ選択)",
           "choices": ["購買発注に分割請求書受領があるが、 まだ入庫がない。" ,
                       "購買発注に、まだ請求書を受領していない分割入庫がある。" ,
                       "購買発注に、同じ数量と金額の入庫と請求書受領がある。" ,
                       "購買発注に、数量が同じで金額が異なる入庫と請求書受領がある。",],
           "answer": ["購買発注に分割請求書受領があるが、 まだ入庫がない。" , "購買発注に、まだ請求書を受領していない分割入庫がある。",]
       },       
       
       # 問題 82
       {   "question_number": 82,
           "question": "財務諸表レポートを実行すると、計算された純利益が予想と異なることがわかりました。 問題の原因は何ですか。(2つ選択)",
           "choices": ["勘定の残高による勘定グループ割当を選択し、それが負債として表示されている" ,
                       "財務諸表注記に属する負債ノードに勘定を追加した。" ,
                       "財務諸表バージョンに割り当てられていない勘定がある。" ,
                       "間違ったノードに勘定を追加し、 それが資産セクションに含まれている",],
           "answer": ["財務諸表注記に属する負債ノードに勘定を追加した。" , "財務諸表バージョンに割り当てられていない勘定がある。",]
       },       
       
       # 問題 83
       {   "question_number": 83,
           "question": "SAP S/4HANA の見越/繰延エンジンの機能および特徴は次のどれですか。(2つ選択)",
           "choices": ["総勘定元帳のすべての通貨がサポートされる。" ,
                       "最大2つの明細がある見越 / 繰延転記がサポートされる。" ,
                       "転記前に、すべての見越/ 繰延計算をレビューおよび承認する必要がある。" ,
                       "総勘定元帳の会計年度バリアントがサポートされる。",],
           "answer": ["総勘定元帳のすべての通貨がサポートされる。" , "総勘定元帳の会計年度バリアントがサポートされる。",]
       },       
       
       # 問題 84
       {   "question_number": 84,
           "question": "外貨評価の実行時に、関連する会計原則はどのように決定されますか。",
           "choices": ["評価方法によって" ,
                       "評価クラスによって" ,
                       "評価タイプによって" ,
                       "評価領域によって",],
           "answer": "評価領域によって"
       },       
       
       # 問題 85
       {   "question_number": 85,
           "question": "組織に決算処理コックピットを導入しています。 タスクグループを定義する利点は何ですか。(2つ選択)",
           "choices": ["テンプレート全体の更新が可能である。" ,
                       "同一または類似のタスクのある複数の会社コードに対応する。" ,
                       "タスクステータスのタスクリスト間監視が可能である。" ,
                       "タスクのタスクリスト間実行が可能である。"],
           "answer": ["テンプレート全体の更新が可能である。" ,"同一または類似のタスクのある複数の会社コードに対応する。" ]
       },          
    ],
    
    "トピック 6: SAP S/4HANA の概要および導入": [
       # 問題 86
       {   "question_number": 86,
           "question": "顧客が SAP およびパートナの垂直型ソリューションを見つけてデプロイできるようにする、インテリジェントエンタープライズのコンポーネントはどれですか。",
           "choices": ["エクスペリエンス管理" ,
                       "ビジネスネットワーク" ,
                       "業種別クラウド" ,
                       "インテリジェントスイート",],
           "answer": "業種別クラウド" 
       },       
       
       # 問題 87
       {   "question_number": 87,
           "question": "SAP HANA の主要な機能/特徴は何ですか。(2つ選択)",
           "choices": ["SAP HANA では、同じテーブルから取引処理と分析処理を実行できる。" ,
                       "SAP HANA は、カラムストアを使用してデータを整理するように最適化されている。" ,
                       "SAP HANA は、階層データモデルアーキテクチャに基づいて構築されている。" ,
                       "SAP HANA は、集計と索引が使用できるよう最適化されている。",],
           "answer": ["SAP HANA では、同じテーブルから取引処理と分析処理を実行できる。" ,"SAP HANA は、カラムストアを使用してデータを整理するように最適化されている。" ]
       },       
       
       # 問題 88
       {   "question_number": 88,
           "question": "SAP Business Technology Platform にはどのような機能がありますか。(2つ選択)",
           "choices": ["顧客がステークホルダのニーズを理解するのをサポートする。" ,
                       "顧客が協働して柔軟なバリューチェーンを構築するのに役立つ。" ,
                       "アプリケーション開発および統合がサポートされる。" ,
                       "データ管理および分析が提供される。",],
           "answer": ["アプリケーション開発および統合がサポートされる。" ,"データ管理および分析が提供される。" ]
       },       
       
       # 問題 89
       {   "question_number": 89,
           "question": "任意のデータベース上で実行できるSAP Fiori アプリはどれですか。(2つ選択)",
           "choices": ["銀行振込実行" ,
                       "勘定コード表管理" ,
                       "債務概要。" ,
                       "得意先会計伝票",],
           "answer": ["銀行振込実行" ,"勘定コード表管理" ]
       },       
       
       # 問題 90
       {   "question_number": 90,
           "question": "SAP S/4HANA でのデータ処理の利点は何ですか。(2つ選択)",
           "choices": ["明細詳細でデータをリアルタイムで利用できる。" ,
                       "メモリ使用を最適化するために、データが常に自動アーカイブされる" ,
                       "任意の明細テーブルからデータがリアルタイムで集計される。" ,
                       "システムのパフォーマンスを向上させるために、データが上位レベルに集約される。",],
           "answer": ["明細詳細でデータをリアルタイムで利用できる。" ,"任意の明細テーブルからデータがリアルタイムで集計される。" ]
       },       
       
       # 問題 90
       {   "question_number": 90,
           "question": "SAP S/4HANA でのデータ処理の利点は何ですか。(2つ選択)",
           "choices": ["明細詳細でデータをリアルタイムで利用できる。" ,
                       "メモリ使用を最適化するために、データが常に自動アーカイブされる" ,
                       "任意の明細テーブルからデータがリアルタイムで集計される。" ,
                       "システムのパフォーマンスを向上させるために、データが上位レベルに集約される。",],
           "answer": ["明細詳細でデータをリアルタイムで利用できる。" ,"任意の明細テーブルからデータがリアルタイムで集計される。" ]
       },       
       
       # 問題 91
       {   "question_number": 91,
           "question": "SAP Fiori ラウンチパッドでは、ページはどのようにユーザに割り当てられますか。",
           "choices": ["ユーザに割り当てられているビジネスロールに割り当てられたセクションを使用する。" ,
                       "ユーザに割り当てられているビジネスロールに直接割り当てる。" ,
                       "ユーザに割り当てられているビジネスロールに割り当てられたグループを使用する。" ,
                       "ユーザに割り当てられているビジネスロールに割り当てられたスペースを使用する。",],
           "answer": ["ユーザに割り当てられているビジネスロールに割り当てられたスペースを使用する。" ]
       },       
       
       # 問題 92
       {   "question_number": 92,
           "question": "あなたは、北米のビジネスマーケットに関心があるグループ資金管理者です。 SAP Fiori で利用できるパーソナライゼーションオプションは何ですか。(2つ選択)",
           "choices": ["簡単にアクセスできるよう、日常業務で必要なすべてのアプリが含まれたタイルグループを登録できる。" ,
                       "管理者のサポートを受けずに、チームの関連アプリへのユーザアクセスを管理できる。" ,
                       "北米のビジネスマーケットのキャッシュポジションに直接アクセスできるタイルを登録できる。" ,
                       "資金レポートの事前定義済み値に従って、 ラウンチパッドのカラーテーマを調整できる。"],
           "answer": ["簡単にアクセスできるよう、日常業務で必要なすべてのアプリが含まれたタイルグループを登録できる。","北米のビジネスマーケットのキャッシュポジションに直接アクセスできるタイルを登録できる。" ]
       },       
       
       # 問題 93
       {   "question_number": 93,
           "question": "SAP Business Network は、 得意先が会社間ビジネスプロセスをデジタル化するのに役立ちます。 ネットワークによって構築されるソリューションはどれですか。(3つ選択)",
           "choices": ["非正規社員" ,
                       "人材管理" ,
                       "調達" ,
                       "旅費",
                       "販売"],
           "answer": ["非正規社員","調達","旅費" ]
       },    
    ],    
          
    "トピック 7: Clean Core の管理": [
       # 問題 94
       {   "question_number": 94,
           "question": "次のうち、Clear Core 統合を実現するために SAP が使用を推奨するAPI タイプはどれですか。(2つ選択)",
           "choices": ["IDoc" ,
                       "OData",
                       "RFC" ,
                       "SOAP"],                       
           "answer": ["OData","SOAP" ]
       },       
       
       # 問題 95
       {   "question_number": 95,
           "question": "あなたは SAP S/4HANA Cloud ブラウンフィールドプロジェクトのコンサルタントです。 ミーティングで、顧客は Clean Core の原則に従って既存のビジネスモデルを再モデリングすることを決定しました。次のうち、再モデリングに使用できる SAP Signavio ソリューションはどれですか。",
           "choices": ["AP Signavio Process Manager" ,
                       "SAP Signavio Process Governance" ,
                       "SAP Signavio Process Intelligence" ,
                       "SAP Signavio Process Insights"],                       
           "answer": "AP Signavio Process Manager" 
       },       
       
       # 問題 96
       {   "question_number": 96,
           "question": "Clean Core の運用を実現するために SAP が推奨する原則は何ですか。(3つ選択)",
           "choices": ["プロセス変革オフィスの一環として、役割と責任を定義する。" ,
                       "Clean Core プラクティスをエンドツーエンドのバリュープロセスチェーンに統合する。" ,
                       "定期的なハウスキーピングタスクおよび手順を確立する。" ,
                       "リリース管理を確立する。",
                       "Clean Core の組織構造、 技術基盤、 および変革手法を確立する。"],                       
           "answer": ["Clean Core プラクティスをエンドツーエンドのバリュープロセスチェーンに統合する。" ,
                       "定期的なハウスキーピングタスクおよび手順を確立する。" ,
                       "リリース管理を確立する。"],
       },       
       
       # 問題 97
       {   "question_number": 97,
           "question": "あなたは SAP S/4HANA Cloud グリーンフィールドプロジェクトのコンサルタントです。 次のうち、 Clean Core のデータ品質を達成して維持するために重点を置く必要がある側面はどれですか。(2つ選択)",
           "choices": ["正確性" ,
                       "効率性" ,
                       "適時性" ,
                       "安定性"],                       
           "answer": ["正確性" ,"適時性"],
       },       
       
       # 問題 98
       {   "question_number": 98,
           "question": "あなたは SAP S/4HANA Cloud グリーンフィールドプロジェクトのコンサルタントです。 Clean Core ジャーニーの一環として、顧客は現在のIT ランドスケープを分析して冗長なシステムを排除し、 効率的なアーキテクチャ設計を確立する必要があります。 次のうち、 分析に使用できるものはどれですか。",
           "choices": ["Lean IX" ,
                       "SAP Solution Manager" ,
                       "SAP Best Practices" ,
                       "SAP Cloud ALM"],                       
           "answer": "Lean IX"
       },       

       # 問題 99
       {   "question_number": 99,
           "question": "ABAP クラウドネイティブ開発に使用できるモデルはどれですか。",
           "choices": ["ABAP Cloud 開発モデル" ,
                       "SAP S/4HANA Cloud 拡張性モデル" ,
                       "ABAP RESTful アプリケーションプログラミングモデル" ],                       
           "answer": "ABAP Cloud 開発モデル"
       },       

       # 問題 100
       {   "question_number": 100,
           "question": "次のうち、リリース済 API を調べるために使用できるものはどれですか。",
           "choices": ["SAP Application Interface Framework" ,
                       "SAP Integration Suite" ,
                       "SAP Business Accelerator Hub"],                       
           "answer": "SAP Business Accelerator Hub"
       },       
    ]     
}


# ===== トップページ =====
@app.route('/')
def index():
    topics = list(quiz_data.keys())
    print("topics in index route:", topics)  # ここでトピックの数と中身を確認
    progress = session.get("index", 0)
    total = session.get("total", 0)
    return render_template('index.html', topics=topics, progress=progress, total=total)

# 共通で問題リストを取得する関数
def get_all_questions():
    selected_topics = session.get('selected_topics', [])
    questions = []
    for topic in selected_topics:
        if topic in quiz_data:
            questions.extend(quiz_data[topic])
    return questions


# ===== クイズ開始 =====
@app.route('/start', methods=['POST'])
def start():
    selected_topics = request.form.getlist('topics')
    shuffle_choices = 'shuffle' in request.form

    if not selected_topics:
        return render_template(
            'index.html',
            topics=list(quiz_data.keys()),
            error="少なくとも1つ選択してください"
        )

    # 選択トピックだけ保存
    session['selected_topics'] = selected_topics
    session['index'] = 0
    session['score'] = 0
    session['shuffle_choices'] = shuffle_choices

    return redirect(url_for('quiz'))


# ===== 問題表示 =====
@app.route('/quiz')
def quiz():
    index = session.get("index", 0)
    questions = get_all_questions()
    total = len(questions)

    if index >= total or total == 0:
        return redirect(url_for('final_result'))

    question = questions[index]
    choices = question["choices"][:]
    if session.get("shuffle_choices", True):
        random.shuffle(choices)

    is_multiple = isinstance(question["answer"], list)

    return render_template(
        'quiz.html',
        question=question,
        choices=choices,
        is_multiple=is_multiple,
        current=index + 1,
        total=total
    )


# ===== 回答チェック =====
@app.route('/check', methods=['POST'])
def check():
    index = session.get("index", 0)
    questions = get_all_questions()
    total = len(questions)

    if index >= total or total == 0:
        return redirect(url_for('final_result'))

    selected = request.form.getlist('choice')
    correct_answer = questions[index]["answer"]

    if isinstance(correct_answer, list):
        is_correct = set(selected) == set(correct_answer)
    else:
        is_correct = selected == [correct_answer]

    if is_correct:
        session["score"] += 1

    return render_template(
        'result.html',
        is_correct=is_correct,
        selected=selected,
        answer=correct_answer
    )


# ===== 次の問題へ遷移 =====
@app.route('/next')
def next_question():
    index = session.get("index", 0) + 1
    questions = get_all_questions()
    total = len(questions)

    if index >= total:
        return redirect(url_for('final_result'))

    session["index"] = index

    return redirect(url_for('quiz'))

# ===== 最終結果表示 =====
@app.route('/final_result')
def final_result():
    score = session.get("score", 0)
    questions = get_all_questions()
    total = len(questions)
    return render_template('final_result.html', score=score, total=total)

@app.route('/abort', methods=['POST'])
def abort():
    # ここでは何もしない（セッションは残す）
    return redirect(url_for('index'))

if __name__ == "__main__":
    app.run(debug=True)