# Flaskというライブラリを読み込む
from flask import Flask, render_template, request, redirect, url_for, session
import random

# Flaskアプリのインスタンスを作成 	Flaskアプリの本体を作る
app = Flask(__name__)

app.secret_key = "super_secret_key"  # セッション用

quiz_data = {
    "トピック 1: 組織割当およびプロセス統合": [
        # 問題 1
        {
            "question": "会社では、売上原価会計に従って損益計算書が構成されています。どの組織ユニットを定義する必要がありますか。",
            "choices": ["事業領域", "セグメント", "利益センタ", "機能領域"],
            "answer": "機能領域",
            "explanation": "売上原価会計に従った損益計算書（CO-PAではなくFIベース）を作成する場合、費用・収益を機能別（販売費、製造費など）に集計する必要があります。その単位が「機能領域」です。事業領域は事業別集計、セグメントはIFRS/US GAAP用、利益センタは収益責任単位であり、売上原価会計の構成単位ではありません。",
        },

        # 問題 2
        {
            "question": "新たに登録した3つの会社コードを同じ管理領域に割り当てようとしています。すべての会社コードで共通である必要がある設定はどれですか。（2つ選択）",
            "choices": ["グループ通貨の元通貨", "運用勘定コード表", "会計年度バリアント", "会計期間バリアント"],
            "answer": ["運用勘定コード表", "会計年度バリアント"],
            "explanation": "管理領域（Controlling Area）に複数会社コードを割り当てる場合、共通である必要があるのは「勘定コードの体系」と「会計年度の期間構造」です。グループ通貨や会計期間バリアントは管理領域とは直接関係ありません。",
        
        },

        # 問題 3
        {
            "question": "会社はフランスに拠点を置いていますが、法律で財務諸表が要求されているスイスに恒久的施設があります。スイスの恒久的施設に登録する必要がある組織ユニットはどれですか。",
            "choices": ["事業領域", "会社コード", "利益センタ", "セグメント"],
            "answer": "会社コード",
            "explanation": "恒久的施設でも、法律上財務諸表を作成する必要がある場合は、会社コード単位で登録し会計処理を行う必要があります。事業領域や利益センタ、セグメントは法的登録単位ではありません。",
        
        },

        # 問題 4
        {
            "question": "SAP S/4HANA でデフォルト設定されている通貨タイプはどれですか。 （２つ選択）",
            "choices": ["10 = 会社コード通貨", "30 = グループ通貨", "20 = 管理領域通貨", "00 = 伝票通貨"],
            "answer": ["10 = 会社コード通貨", "00 = 伝票通貨"],
            "explanation": "デフォルト通貨は基本的に「会社コード通貨」と「伝票通貨」です。伝票通貨は入力伝票単位、会社コード通貨はFI報告用です。グループ通貨や管理領域通貨はデフォルトではありません。",
        },

        # 問題 5
        {
            "question": "得意先の前受金が販売管理（SD）で処理される過程を的確に説明している文は次のどれですか。",
            "choices": [
                "前受金請求が Fl 備忘明細として登録された後、SD 受注が自動生成される。",
                "前受金請求が Fl 備忘明細として登録された後、SD 請求伝票が自動生成される。",
                "前受金請求が SD 受注として登録された後、備忘明細として Fl に自動的に転記される。",
                "前受金請求が SD 請求伝票として登録された後、備忘明細として Fl に自動的に転記される。"
            ],
            "answer": "前受金請求が SD 受注として登録された後、備忘明細として Fl に自動的に転記される。",
            "explanation": "SDで前受金請求を登録すると、まずSD受注として記録され、会計には備忘明細として転記されます。請求伝票はまだ作成されません。",
        
        },

        # 問題 6
        {
            "question": "SAP S/4HANA に購買発注見越を実装する必要があります。以下のユースケースのうち、どれが関連しますか。 （２つ選択）",
            "choices": ["サービスの購入", "消費品目の購入", "在庫の原材料の購入", "固定資産の購入 (直接資本化方式を使用)"],
            "answer": ["サービスの購入", "消費品目の購入"],
            "explanation":"購買発注見越は、サービスや消費品目の未着発生費用の計上に使用されます。",
        
        },

        # 問題 7
        {
            "question": "連結準備を直接サポートするために使用されるオブジェクトはどれですか。",
            "choices": ["機能領域", "会社/取引パートナ", "元帳/元帳グループ", "セグメント/利益センタ"],
            "answer": "会社/取引パートナ",
            "explanation":"連結会計では会社間取引（Intercompany）の消去が必要。これをサポートするために、会社間取引のオブジェクトとして「会社/取引パートナ」を使用します。",
        
        },

        # 問題 8
        {
            "question": "あなたの会社は IFRS 会計原則に従い、\"消費財\" と \"プロフェッショナル製品\" の 2つの主要部門について、完全な財務諸表を発行する必要があります。このシナリオでセグメントレポートを実現するために必要なものは何ですか。 （３つ選択）",
            "choices": ["収益性セグメント", "事業領域", "セグメント", "利益センタ", "伝票分割"],
            "answer": ["セグメント", "利益センタ", "伝票分割"],
            "explanation":"IFRSで部門別財務諸表を作成する場合、セグメント単位で集計が必要です。利益センタと伝票分割があれば、収益・費用を正確にセグメントに割り当て可能です。",
        
        },

        # 問題 9
        {
            "question": "以下のうち、複数の会社コードで共有できる組織要素はどれですか。 （３つ選択）",
            "choices": ["販売組織", "プラント", "事業領域", "利益センタ", "セグメント"],
            "answer": ["事業領域", "利益センタ", "セグメント"],
            "explanation":"これらの組織要素は複数会社コードで共通利用可能です。販売組織やプラントは会社コード単位でのみ使用可能です。",
        
        },

        # 問題 10
        {
            "question": "SAP S/4HANA では、唯一の正しい情報源を表すユニバーサルジャーナル (テーブル ACDOCA) が導入されました。テーブル ACDOCA にはどの明細が記録されていますか。 （３つ選択）",
            "choices": ["会社間転記", "付替によって発生する一次原価", "配賦によって発生する二次原価", "原価センタの予算原価", "計画償却額"],
            "answer": ["会社間転記", "付替によって発生する一次原価", "配賦によって発生する二次原価"],
            "explanation":"ユニバーサルジャーナルはFI/COを統合して一次・二次原価を記録。会社間転記も記録されます。原価センタの予算原価や計画償却額はACDOCAには含まれません。",
        
        },
        # 問題 11
        {
            "question": "SAP S/4HANA システムで、どの会社コードでも使用されなくなった業務の G/L勘定をアーカイブする必要があります。 G/L勘定のすべてのデータをアーカイブするための前提条件は、次のうちどれですか。 （３つ選択）",
            "choices": [
             "勘定が自動勘定設定で使用されない。",
             "勘定に取引金額が存在しない。",
             "G/L勘定の勘定コード表データに削除フラグを設定する。",
             "取引金額が、カスタマイズ可能な年数よりも古い。",
             "G/L勘定の会社コードデータに削除フラグを設定する。"
            ],
            "answer": [
             "勘定に取引金額が存在しない。",
             "G/L勘定の勘定コード表データに削除フラグを設定する。",
             "G/L勘定の会社コードデータに削除フラグを設定する。"
            ],
            "explanation":"G/L勘定を完全にアーカイブするには、残高がなく、削除フラグが設定されている必要があります。",
        
        },

        # 問題 12
        {
            "question": "以下のうち、特定の元帳に対して定義できる通貨タイプはどれですか。 （３つ選択）",
            "choices": [
             "00 = 伝票通貨",
             "10 = 会社コード通貨",
             "30 = グループ通貨",
             "40 = ハード通貨",
             "60 = グローバル会社通貨"
         ],
            "answer": [
             "30 = グループ通貨",
             "40 = ハード通貨",
             "60 = グローバル会社通貨"
         ],
            "explanation":"元帳単位で定義可能なのはグループ通貨・ハード通貨・グローバル会社通貨（レポートや多通貨管理用）です。伝票通貨や会社コード通貨は元帳単位ではありません。",
        
        },

        # 問題 13
        {
            "question": "財務会計で代入を定義します。代入の各ステップに対して、次のどのパーツを定義する必要がありますか。 （２つ選択）",
            "choices": [
                "代入値",
                "前提条件",
                "呼び出し位置",
                "チェック明細"
            ],
            "answer": [
                "代入値",
                "前提条件"
            ],
            "explanation":"財務会計の代入は、どのフィールドを置き換えるか（代入値）、条件（前提条件）を設定します。",
        
        },

        # 問題 14
        {
            "question": "機能領域はどのレベルで定義しますか。",
            "choices": [
                "管理領域",
                "クライアント",
                "会社コード",
                "財務諸表バージョン"
            ],
            "answer": "クライアント",
            "explanation":"機能領域は会計上のレポート単位であり、会社コードを跨いでも共通で使用可能なため、クライアントレベルで定義されます。",
        
        }
    ],

    "トピック 2: 総勘定元帳": [
        # 問題 15
        {
            "question": "伝票の入力ビューで、総勘定元帳ビューよりも明細の数が少ないことに気付きました。どのような理由が考えられますか。",
            "choices": [
                "追加加元帳が設定されている。",
                "売上税が総勘定元帳ビューの詳細に転記されている。",
                "補助元帳勘定が総勘定元帳ビューの詳細に表示されている。",
                "伝票分割が有効化されている。"
            ],
            "answer": "伝票分割が有効化されている。",
            "explanation": "伝票分割が有効化されていると、入力ビューより総勘定元帳ビューの方が明細が多くなる場合があります。伝票分割有効時＝総勘定元帳で明細が増える。",
        },

        # 問題 16
        {
            "question": "会社コードの一般仕訳を転記しています。エントリを転記した後、伝票番号が誤った番号範囲にあることに気付きました。伝票を反対仕訳した後、伝票の再転記時に何を変更する必要がありますか。",
            "choices": ["伝票タイプ", "転記キー", "ソートキー", "伝票番号"],
            "answer": "伝票タイプ",
            "explanation":"伝票番号が誤った番号範囲の場合、再転記時には伝票タイプを正しい範囲に変更する必要があります。番号範囲エラー＝伝票タイプを確認。",
        },

        # 問題 17
        {
            "question": "税計算表を設定する必要があります。定義する必要のある主な要素は何ですか。(3つ選択)",
            "choices": ["勘定キー", "税コード", "ステップ順序", "税カテゴリ", "条件タイプ"],
            "answer": ["勘定キー", "ステップ順序", "条件タイプ"],
            "explanation":"税計算表（Tax Calculation Procedure）は、勘定キー、ステップ順序、条件タイプで構成されます。税計算の流れを定義するためです。税計算表＝勘定キー＋ステップ順序＋条件タイプ。",
        },

        # 問題 18
        {
            "question": "リーディング元帳が他のパラレル標準元帳と異なる点は何ですか。",
            "choices": [
                "すべての会社コードに割り当てられている。",
                "他の元帳から金額が導出できない。",
                "グループ評価を表すために使用される。",
                "セグメントレポートの実行に使用される。"
            ],
            "answer": "すべての会社コードに割り当てられている。",
            "explanation":"リーディング元帳（Leading Ledger）は全会社コードに割り当てられる元帳です。グループ会計や全社統一財務報告に使用されます。リーディング元帳＝全会社コード共通。",
        },

        # 問題 19
        {
            "question": "二つの通貨間の外貨換算比率はどのレベルで更新しますか",
            "choices": ["評価タイプ", "換算レートタイプ", "伝票タイプ", "通貨タイプ"],
            "answer": "換算レートタイプ",
            "explanation":"外貨換算比率は換算レートタイプ（Exchange Rate Type）単位で更新します。会計目的に応じた為替換算が可能です。為替比率更新＝換算レートタイプ単位。",
        },

        # 問題 20
        {
            "question": "自動消込プログラムによって消し込まれない明細は次のうちどれですか(３つ選択)",
            "choices": [
                "消費税のある明細",
                "統計転記",
                "売上税と使用税のある明細",
                "源泉徴収税のある明細",
                "備忘明細"
            ],
            "answer": ["統計転記", "源泉徴収税のある明細", "備忘明細"],
            "explanation":"SAPでは自動消込（Automatic Clearing）は、通常の債権・債務明細を金額・勘定・取引先などで照合して自動的に消し込む機能です。統計転記、源泉徴収税のある明細、備忘明細は消し込まれません。自動消込対象は実際の債権・債務で金額が確定している明細に限られます。",
        },
        
        # 問題 21
        {
            "question_number": 21,
            "question": "G/L勘定に対して明細消込管理を無効化するための前提条件はなんですか。",
            "choices": [
                "転記されていない",
                "貸借が一致する",
                "転記に対してブロックされている",
                "未消込明細がない"
            ],
            "answer": "貸借が一致する",
            "explanation":"G/L勘定で明細消込管理（Open Item Management）を無効化するには、その勘定に未消込明細がなく、貸借が一致していることが前提です。明細消込管理を外すには、勘定残高の整合性（貸借一致）が必須。",
        },

        # 問題 22
        {
            "question_number": 22,
            "question": "代替勘定を G/L 勘定に割り当てようとしていますが、エラーメッセージが表示されます。どのような理由が考えられますか。",
            "choices": [
                "代替勘定コード表を会社に割り当てていない。",
                "会社コードに対して代替勘定が登録されていない。",
                "代替勘定が、会社コードの別のG/L 勘定にすでに割り当てられている。",
                "代替勘定コード表を運用勘定コード表に割り当てていない。"
            ],
            "answer": "代替勘定が、会社コードの別のG/L 勘定にすでに割り当てられている。",
            "explanation":"代替勘定（Alternative Account）は、勘定間のマッピングで一意である必要があります。同じ会社コード内で重複して割り当てることはできないためエラーになります。代替勘定は1社コード内で一意に割り当てる必要があります。",
        },

        # 問題 23
        {
            "question_number": 23,
            "question": "G/L 勘定を登録しようとしていますが、勘定コードが許容範囲外であるため、エラーが発生します。番号範囲を拡張するには、どのオブジェクトをカスタマイズする必要がありますか。",
            "choices": [
                "許容範囲グループ",
                "勘定タイプ",
                "勘定グループ",
                "勘定コード表"
            ],
            "answer": "勘定グループ",
            "explanation":"G/L勘定の番号範囲は勘定グループごとに設定されています。新しい勘定を登録するときに番号範囲外ですと出る場合、勘定グループの範囲を調整する必要があります。G/L勘定番号の制御は勘定グループ単位。",
        },

        # 問題 24
        {
            "question_number": 24,
            "question": "グループ勘定コード表はどこで割り当てますか",
            "choices": [
                "会社コード",
                "会社",
                "G/L勘定",
                "運用勘定コード表"
            ],
            "answer": "運用勘定コード表",
            "explanation":"グループ勘定は会社コード単位ではなく、複数会社に共通する勘定コードを統合管理するための仕組み。割当先は運用勘定コード表（Operating Chart of Accounts）です。グループ勘定は運用勘定コード表単位で共通管理。",
        },

        # 問題 25
        {
            "question_number": 25,
            "question": "G/L 勘定の勘定コード表レベルで更新される項目はどれですか(3つ選択)",
            "choices": [
                "グループ勘定コード",
                "項目ステータスグループ",
                "テキスト(短)",
                "代替勘定コード",
                "勘定グループ"
            ],
            "answer": ["グループ勘定コード", "テキスト(短)", "勘定グループ"],
            "explanation":"勘定コード表レベルで管理されるのは会社コードに依存しない共通情報です。更新項目にはグループ勘定コード、テキスト(短)、勘定グループが含まれます。会社共通で変更可能な基本情報が対象。",
        },

        # 問題 26
        {
            "question_number": 26,
            "question": "G/L 勘定を新規会社コードに拡張しようとしていますが、データが不完全でエラーが発生します。カスタマイズ可能な全ての項目が、項目ステータスで任意入力に設定されています。G/L勘定の拡張時に常に更新する必要がある項目はどれですか。(2つ選択)",
            "choices": [
                "勘定通貨",
                "項目ステータスグループ",
                "ソートキー",
                "勘定コード"
            ],
            "answer": ["勘定通貨", "項目ステータスグループ"],
            "explanation":"G/L勘定拡張時に会社コード固有情報として勘定通貨と項目ステータスグループは必須項目です。拡張時には会社コード固有の基本設定が必要。",
        },

        # 問題 27
        {
            "question_number": 27,
            "question": "伝票分割の設定を担当しています。重要な設定は何ですか(二つ選択)",
            "choices": [
                "取引バリアント",
                "伝票タイプ",
                "伝票番号範囲",
                "項目ステータスバリアント"
            ],
            "answer": ["取引バリアント", "伝票タイプ"],
            "explanation":"伝票分割（Document Splitting）は複数の勘定間にまたがる仕訳を会計期間・セグメント・コストセンター単位で分割表示する機能です。重要設定は伝票タイプと取引バリアントで、分割対象とルールの定義がキモです。",
        },

        # 問題 28
        {
            "question_number": 28,
            "question": "新しい標準元帳を定義するときに、一般仕訳をマニュアルで転記するには、以下のどのアクションを実行する必要がありますか。",
            "choices": [
                "元帳に会社コードを割り当てる",
                "基本元帳を定義する",
                "勘定コード表を元帳に割り当てる",
                "元帳グループに元帳を含める"
            ],
            "answer": "元帳に会社コードを割り当てる",
            "explanation":"新しい標準元帳（Leading Ledger）を作成しても、会社コードに割り当てないとマニュアル転記できません。元帳と会社コードの関連付けが最重要です。",
        },

        # 問題 29
        {
            "question_number": 29,
            "question": "損益計算書 (P&L) に値が表示されるのは、どの G/L勘定タイプですか。(3つ選択)",
            "choices": [
                "営業外費用または収入",
                "二次原価",
                "一次原価または収益",
                "貸借対照表勘定",
                "現金勘定"
            ],
            "answer": ["営業外費用または収入", "二次原価", "一次原価または収益"],
            "explanation":"P&L勘定タイプは収益・費用勘定です。損益計算書に表示されるのは営業外費用または収入、二次原価、一次原価または収益です。損益勘定と貸借勘定の区別を覚える。",
        },

        # 問題 30
        {
            "question_number": 30,
            "question": "会計年度バリアントは何を定義しますか(二つ選択)",
            "choices": [
                "会計期間の開始日付と終了日付",
                "会計期間数",
                "転記可能な会計期間",
                "特別会計期間への転記権限",
            ],
            "answer": ["会計期間の開始日付と終了日付", "会計期間数"],
            "explanation":"会計年度バリアント (Fiscal Year Variant) は、会計期間の開始日付と終了日付、会計期間数を定義します。期間の構造を決めるのが年度バリアント。",
        },

        # 問題 31
        {
            "question_number": 31,
            "question": "通貨タイプはどこで割り当てますか",
            "choices": [
                "会社",
                "評価領域",
                "会計原則",
                "元帳",
            ],
            "answer": "元帳",
            "explanation":"通貨設定は元帳 (Ledger) ごとに割り当てます。評価通貨やグループ通貨を元帳単位で管理します。通貨設定はレポート単位（元帳）。",
            
        },

        # 問題 32
        {
            "question_number": 32,
            "question": "クローズされた会計期間に転記された伝票の反対仕訳を転記しようとしています。オリジナル伝票とは異なる日付で反対仕訳を入力できるようにするには、どのオブジェクトを設定しますか。",
            "choices": [
                "会社コード",
                "反対仕訳方法",
                "伝票タイプ",
                "反対仕訳理由"
            ],
            "answer": "反対仕訳理由",
            "explanation":"クローズ済み会計期間に反対仕訳をオリジナル日付と異なる日付で転記するには反対仕訳理由を設定する必要があります。反対仕訳で日付を変更するには理由マスタ設定が必須です。",
            
        },

        # 問題 33
        {
            "question_number": 33,
            "question": "15の法人組織で構成される企業グループの連結財務レポートを準備します。SAP S/4HANA システムで1つのクライアントに10の会社コードが定義されています。その他については、個別のレガシーシステムが使用されます。連結シナリオに対応するには、SAP S/4HANAシステムでいくつの会社を定義する必要がありますか。",
            "choices": [
                "15",
                "5",
                "10",
                "1"
            ],
            "answer": "15",
            "explanation":"連結財務報告ではすべての会社コードをシステム内で定義する必要があります。連結対象会社コードはすべて登録。",

        }  
    ],

    "トピック 3: 債務管理および債権管理": [    
        # 問題 34
        {   "question_number": 34,
            "question": "得意先未消込明細を消し込みましたが、 このアクションを取り消そうとしています。 利用可能なオプションは何ですか。(2つ選択)",
            "choices": ["消込伝票の反対仕訳", "消込伝票のリセット", "消込伝票のリセットおよび反対仕訳", "消込伝票の再転記"],
            "answer": ["消込伝票のリセット", "消込伝票のリセットおよび反対仕訳"],
            "explanation":"未消込明細を誤って消し込んだ場合、SAPでは「消込伝票をリセット」して消し込みを取り消すことが可能です。「リセットおよび反対仕訳」を選ぶと、リセットと同時に会計上の反対仕訳も作成されます。消込は会計伝票に基づく処理なのでリセットで元に戻せます。",

        },

        # 問題 35
        {   "question_number": 35,
            "question": "SAP S/4HANA における備忘明細のコンセプトについて説明する必要があります。 備忘明細に固有の特性はどれですか。(3つ選択)",
            "choices": ["支払プログラムと督促プログラムによってアクセスすることができる。","入力ビューでのみ総勘定元帳を更新する。","貸借が一致しない転記を生成する。","得意先コードおよび仕入先コードの未消込明細として管理される。","統計転記を生成する。"],
            "answer": ["支払プログラムと督促プログラムによってアクセスすることができる。","貸借が一致しない転記を生成する。","得意先コードおよび仕入先コードの未消込明細として管理される。"],
            "explanation":"備忘明細は財務会計上、実際の現金移動を伴わない記録用明細です。未消込明細として管理され、貸借が一致しない転記も生成可能で、支払プログラムや督促プログラムで参照できます。統計的に管理するだけで、帳簿残高は変わりません。",
            
        },

        # 問題 36
        {   "question_number": 36,
            "question": "債権管理では理由コードを使用して何を制御しますか(3つ選択)",
            "choices": ["前受/前払金の特殊仕訳コード","残余明細が転記される勘定","得意先に送付される支払通知のタイプ","クレームを受けた残余明細を与信限度チェックから除外","支払の伝票番号"],
            "answer": ["残余明細が転記される勘定","得意先に送付される支払通知のタイプ","クレームを受けた残余明細を与信限度チェックから除外"],
            "explanation":"債権管理の理由コードは、支払差額やクレームの扱い、通知内容を制御するために使われます。残余明細の転記や与信チェックの除外など未消込明細や与信処理を自動制御できます。",
            
        },

        # 問題 37
        {   "question_number": 37,
            "question": "3方向照合は、S/4HANA で調達取引を転記するために使用される標準手順です。 どのように動作しますか。",
            "choices": ["転記日付","入庫日付","入力日付","起算日","伝票日付"],
            "answer": ["転記日付","入力日付","伝票日付"],
            "explanation":"3方向照合（購買発注・入庫・請求書）では、転記日付、入力日付、伝票日付を基準に照合が行われます。日付管理は財務・在庫・購買の連携において重要です。",
        },

        # 問題 38
        {   "question_number": 38,
            "question": "得意先の前受金が販売管理（SD）で処理される過程を的確に説明している文は次のどれですか。",
            "choices": ["入庫は、購買発注を参照して登録する必要がある。","購買発注は、購買依頼を参照して登録する必要がある。","3つのロジスティクスステップごとに財務伝票が生成される。","請求書は、入庫を参照して登録する必要がある。"],
            "answer": "入庫は、購買発注を参照して登録する必要がある。",
            "explanation":"入庫は購買発注を参照して登録する必要があります。これにより、財務会計で適切な仕訳が作成され、在庫・債権が連動します。入庫と購買発注のリンクが財務転記に必須です。",
            
        },
        # 問題 39
        {   "question_number": 39,
            "question": "支払方法を定義します。 会社コードのレベルではどのパラメータを定義しますか。(2つ選択)",
            "choices": ["支払媒体" ,"使用可能通貨" ,"最低支払額と最高支払額" ,"外貨支払可能"],
            "answer": ["最低支払額と最高支払額" ," 外貨支払可能"],
            "explanation":"支払方法設定では会社コードごとの制約を設定できます。最低支払額や最高支払額、外貨支払可否は会社コードレベルで管理されます。",
            
        },

        # 問題 40
        {   "question_number": 40,
            "question": "得意先との間で金額 EUR 10000 の保証について同意しました。この保証を SAP S/4HANA に記録すると、 どのような結果になりますか。",
            "choices": ["2つの備忘明細" ," 1つの統計明細" ," 2つの統計明細" ," 1つの備忘明細"],
            "answer": "2つの統計明細",
            "explanation":"保証契約は財務に影響を与えず統計的に管理されます。1つの保証で「与信保証」「残高参照用」の2つの統計明細が作成されます。",
            
        },

        # 問題 41
        {   "question_number": 41,
            "question": "ビジネスパートナーマスタレコードで更新する督促関連データは何ですか(2つ選択)",
            "choices": ["督促保留" ," 督促領域" ," 督促間隔日数" ," 督促キー"],
            "answer": ["督促保留" ," 督促領域"],
            "explanation":"督促関連データは顧客マスタで管理されます。督促保留や督促領域により、特定顧客や範囲で督促を制御できます。",
        },

        # 問題 42
        {   "question_number": 42,
            "question": "支払差額の残余明細を使用して、得意先からの入金を転記します。結果はどのようになりますか。(2つ選択)",
            "choices": ["残余明細が原価勘定に欠損処理される。" ,"元の未消込明細と残余明細の両方が、 未消込明細として勘定に残る。" ,"残余明細が新規売掛金になる。" ,"元の伝票と入金が消し込まれる。"],
            "answer": ["残余明細が新規売掛金になる。" ,"元の伝票と入金が消し込まれる。"],
            "explanation":"支払差額を残余明細として転記すると、元伝票は入金と消し込まれ、差額分は新しい未消込明細として売掛金に残ります。残余明細は新規未消込明細として扱われます。",
            
        },

        # 問題 43
        {   "question_number": 43,
            "question": "標準販売プロセスにおいて、 COGS (cost of goods sold) 転記が財務会計で生成されるのはいつですか。",
            "choices": ["PGI 実行(出庫転記)" ,"得意先請求書の発行" ,"請求伝票の登録" ,"出荷伝票の登録"],
            "answer": "PGI 実行(出庫転記)",
            "explanation":"COGS（売上原価）は、PGI 実行(出庫転記)時に財務会計で自動転記されます。原価計算は物理出庫と連動して行われます。請求伝票や出荷伝票の登録では会計伝票は生成されません。",
        },

        # 問題 44
        {   "question_number": 44,
            "question": "督促レベルで設定できるパラメータはどれですか。(2つ選択)",
            "choices": ["延滞日数" ,"金利フラグ" ,"支払期日までの日数" ,"明細毎猶予日数"],
            "answer": ["延滞日数" ,"支払期日までの日数"],
            "explanation":"督促レベルでは、延滞日数や支払期日までの日数を基準に判定や通知タイミングを制御します。日数設定により督促の自動化が可能です。",
            
        },


        # 問題 45
        {   "question_number": 45,
            "question": "支払が必要な請求書の入力時には、どの日付が設定される必要がありますか",
            "choices": ["参照日付" ,"支払日" ,"支払基準日" ,"受注日付"],
            "answer": "支払基準日",
            "explanation":"支払予定の決定には支払基準日が重要です。請求書入力時、この日付が基準となって支払スケジュールが作成されます。支払計算の基準日を理解することがポイントです。",
            
        },

        # 問題 46
        {   "question_number": 46,
            "question": "SAP S/4HANA システムにおける督促処理の3つの必須ステップは何ですか。(3つ選択)",
            "choices": ["督促処理実行をスケジュールする" ,"督促提案を承認する" ,"督促提案を変更する" ,"督促プログラムのパラメータを更新する" ,"督促状印刷を開始する"],
            "answer": ["督促処理実行をスケジュールする","督促プログラムのパラメータを更新する","督促状印刷を開始する"],
            "explanation":"督促処理は、①パラメータ設定、②処理実行、③督促状印刷の3ステップが必要です。承認や変更は任意であり必須ではありません。ステップ順序と必須処理を把握することが重要です。",
            
        },


        # 問題 47
        {   "question_number": 47,
            "question": "財務会計でクレジットメモを入力しようとしていますが、 入力した支払条件が無視される理由が不明です。 その理由は何ですか。(2つ選択)",
            "choices": ["入力された支払条件に基づいて決定された期日が過去の日付です。" ,"クレジットメモの「参照」項目が空白になっている。" ,"クレジットメモが請求書を参照せずに登録された。" ,"クレジットメモが財務会計に入力された。"],
            "answer": ["クレジットメモの「参照」項目が空白になっている。" ,"クレジットメモが請求書を参照せずに登録された。"],
            "explanation":"クレジットメモの参照項目が空白、もしくは請求書を参照せずに登録されると支払条件が無視されます。クレジットメモは必ず参照伝票が必要です。",
        },

        # 問題 48
        {   "question_number": 48,
            "question": "連絡文書タイプに対して、次のどのレベルで印刷プログラムおよびそのバリアントを割り当てることができますか。(2つ選択)",
            "choices": ["会社コード" ,"システム" ,"クライアント" ,"会社"],
            "answer": ["会社コード","クライアント"],
            "explanation":"印刷プログラムとバリアントはクライアント全体および会社コード単位で割り当て可能です。文書タイプ設定はスコープ（クライアント／会社コード）を意識します。",
            
        },

        # 問題 49
        {   "question_number": 49,
            "question": "新しい連絡文書タイプの設定時に指定できるパラメータは次のどれですか。(3つ選択)",
            "choices": ["必要な日付項目の数" ,"必須の会社コード" ,"必須の勘定" ,"必須の理由コード" ,"必須の伝票番号"],
            "answer": ["必要な日付項目の数" ,"必須の勘定","必須の伝票番号"],
            "explanation":"連絡文書タイプでは、文書作成時に必須となるデータ項目（勘定・伝票番号・日付）を設定できます。連絡文書タイプは入力必須項目を定義可能です。",
            
        },


        # 問題 50
        {   "question_number": 50,
            "question": "複数の会社コードを1つの支払処理に含めようとしています。 会社コードの前提条件は何ですか。",
            "choices": ["支払取引の設定が同じである必要がある。","同じ管理領域に属している必要がある。","同じ国に存在する必要がある。","すべて同じ会社に属している必要がある。"],
            "answer": "同じ国に存在する必要がある。",
            "explanation":"複数会社コードを1つの支払処理に含めるには、同一国である必要があります。支払処理の会社コード統合には国制約があることを理解することがポイントです。",
            
        },

        # 問題 51
        {   "question_number": 51,
            "question": "債権と債務を再グループ化するために、何を設定しますか",
            "choices": ["ソート方法" ,"計算方法" ,"引当方法" ,"評価方法"],
            "answer": "ソート方法",
            "explanation":"債権・債務を再グループ化して整理する場合、ソート方法を設定して勘定の順序や優先度を決定します。再グループ化 = ソート順の制御が重要です。",
            
        },
    ],  
 
   "トピック 4: 固定資産管理": [
       # 問題 52
       {   "question_number": 52,
           "question": "会社コードに対して残高繰越を実行します。 ログを確認すると、固定資産に関するエラーが表示されています。 このエラーの原因は何ですか。",
           "choices": ["建設仮勘定の決済を実行していない。" ,"不完全な資産マスタレコードがある。" ,"前会計年度をクローズしていない。" ,"減価償却が完全に転記されていない。"],
           "answer": "前会計年度をクローズしていない。",
           "explanation":"会社コードに対して残高繰越を実行する場合、前会計年度が正式にクローズされていないと固定資産やその他勘定でエラーが発生します。前年度クローズが前提条件です。",
           
       },


       # 問題 53
       {   "question_number": 53,
           "question": "1つの資産の減価償却費を2つの原価センタに転記しようとしています。この処理をどのように実行しますか。",
           "choices": ["資産マスタデータに実際の原価センタと統計原価センタを割り当てる。","資産マスタデータに2つの実際の原価センタを割り当てる。","資産マスタデータに、 2つの原価センタに定期的に決済する実績内部指図を割り当てる。","資産マスタデータに、 2つの原価センタに定期的に決済する統計指図を割り当てる。"],
           "answer": "資産マスタデータに、 2つの原価センタに定期的に決済する実績内部指図を割り当てる。",
           "explanation":"減価償却費を複数の原価センタに割り当てるには、資産マスタに定期的に決済する実績内部指図を割り当てる必要があります。これにより費用が複数センタに正しく分配されます。",
           
       },


       # 問題 54
       {   "question_number": 54,
           "question": "パラメータ「貸借対照表」 および 「一致」 が有効な固定資産管理の勘定割当として、(設備予算管理に関連しない) WBS 要素を有効化しました。 結果はどのようになりますか。(2つ選択)",
           "choices": ["資産マスタデータの WBS 要素は、計画償却記帳時に変更することができる。", "WBS 要素は決済に使用できなくなる。","WBS 要素は、資産マスタレコードに入力することができる。","資産が資本化されると、 資産マスタレコードでWBS 要素を変更できなくなる。"],
           "answer": ["WBS 要素は、資産マスタレコードに入力することができる。" ,"資産が資本化されると、 資産マスタレコードでWBS 要素を変更できなくなる。"],
           "explanation":"WBS要素は資産作成時に入力可能ですが、資産が資本化されると変更不可となります。計画償却時や決済時に変更できません。",
       },


       # 問題 55
       {   "question_number": 55,
           "question": "償却領域 01 の特性は何ですか。(2つ選択)",
           "choices": ["常にリアルタイムで転記する必要がある。" ,"他の領域から値を引き継ぐことはできない。" ,"原価計算評価領域タイプとして定義されている必要がある。" ,"リーディング元帳 OL にリンクされている必要がある。"],
           "answer": ["常にリアルタイムで転記する必要がある。" ,"他の領域から値を引き継ぐことはできない。"],
           "explanation":"償却領域 01 はリーディング領域であり、常にリアルタイムで転記され、他の領域から値を引き継ぐことはできません。COや他領域とのリンクはありません。",
           
       },


       # 問題 56
       {   "question_number": 56,
           "question": "固定資産管理の勘定設定はどのレベルで定義しますか。(二つ選択)",
           "choices": ["クライアント" ,"勘定コード表" ,"会社コード" ,"償却表"],
           "answer": ["勘定コード表" ,"会社コード" ,"償却表"],
           "explanation":"固定資産管理の勘定設定は、勘定コード表と会社コードレベルで定義します。勘定コード表で共通設定を管理し、会社コードごとに個別設定が可能です。クライアントや償却表レベルでは勘定設定は定義できません。",
           
       },

       # 問題 57
       {   "question_number": 57,
           "question": "カスタマイジングで統合資産取得の技術消込勘定を定義します。 どの前提条件を満たす必要がありますか。(2つ選択)",
           "choices": ["勘定が各資産クラスの勘定設定で定義されている。" ,"勘定が貸借対照表勘定である。" ,"勘定が固定資産に対する統制勘定として定義されている。" ,"勘定が未消込明細管理勘定として定義されている。"],
           "answer": ["勘定が貸借対照表勘定である。" ,"勘定が固定資産に対する統制勘定として定義されている。"],
           "explanation":"技術消込勘定は、B/S勘定で固定資産管理用の統制勘定として定義されている必要があります。他の設定（資産クラスや未消込明細管理）は前提条件ではありません。",
       },

       # 問題 58
       {   "question_number": 58,
           "question": "固定資産管理でトランザクション AS91 を使用してレガシーデータを転送すると、何を実現できますか。",
           "choices": ["マスタデータの登録","G/Lで集計の欠損を転記する" ,"レガシーデータ転送の会社コードステータスの設定" ,"取込価額の転記"],
           "answer": "マスタデータの登録",
           "explanation":"AS91トランザクションは、レガシーデータをSAPに転送し、資産マスタデータを登録するためのものです。G/L転記やステータス設定ではありません。",
           
       },

       # 問題 59
       {   "question_number": 59,
           "question": "システムでパラレル通貨が使用されています。 パラレル通貨の償却領域の転記区分は何ですか。",
           "choices": ["G/Lへのリアルタイム転記" ,"G/Lへの転記なし" ,"APC をリアルタイムで、 減価償却を定期的に転記" ,"G/Lへの定期転記"],
           "answer": "G/Lへの転記なし",
           "explanation":"パラレル通貨領域の償却は統計目的のみで、G/Lには転記されません。通常領域のようなリアルタイム転記や定期転記は行われません。",
                  
        },


       # 問題 60
       {   "question_number": 60,
           "question": "SAP S/4HANA で建設仮勘定をどのように使用するのかを説明するように求められました。 何を強調すればよいですか。(2つ選択)",
           "choices": ["建設仮勘定を完全に資本化した後でも、クレジットメモを転記できる。" ,"貸借対照表の償却領域で、 建設仮勘定に対して減価償却の計算と記帳を実行できる。" ,"建設仮勘定を設備予算管理とともに使用することはできない。" ,"建設仮勘定に対する特別税償却と投資援助を転記できる。"],
           "answer": ["建設仮勘定を完全に資本化した後でも、クレジットメモを転記できる。","建設仮勘定に対する特別税償却と投資援助を転記できる。"],
           "explanation":"建設仮勘定（CAPEX）では、完全資本化後でもクレジットメモを転記可能であり、特別税償却や投資援助の転記も可能です。通常の償却計算や予算管理とは別の処理です。",
           
       },


       # 問題 61
       {   "question_number": 61,
           "question": "固定資産管理でセグメントレポートを有効化すると、 どのような結果になりますか。(2つ選択 )",
           "choices": ["セグメントが追加勘定割当設定に表示される。" ,"セグメントが既存の資産マスタデータで自動的に更新される。" ,"セグメントが資産マスタデータの画面レイアウトに表示される。" ,"セグメント有効化を取り消すことができる。"],
           "answer": ["セグメントが追加勘定割当設定に表示される。" ,"セグメントが資産マスタデータの画面レイアウトに表示される。"],
           "explanation":"固定資産管理でセグメントレポートを有効化すると、セグメントが追加勘定割当設定に表示され、資産マスタ画面でも入力・確認可能になります。既存資産への自動更新は行われません。",
           
       },


       # 問題 62
       {   "question_number": 62,
           "question": "カスタマイジングでは、統合資産取得の技術消込勘定をどのレベルで定義できますか。(2つ選択)",
           "choices": ["資産クラス" ,"勘定設定" ,"勘定コード表" ,"償却領域"],
           "answer": ["勘定設定" ,"勘定コード表"],
           "explanation":"技術消込勘定の定義は勘定設定および勘定コード表レベルで管理されます。資産クラスや償却領域では定義できません。",
       },

       # 問題 63
       {   "question_number": 63,
           "question": "償却開始日を決定するには、次のどの日付を使用しますか。",
           "choices": ["支払基準日" ,"資產評価日" ,"転記日付" ,"取得日"],
           "answer": "資產評価日",
           "explanation":"償却開始日として使用するのは資産評価日です。取得日や伝票日付ではなく、資産が評価される日が基準となります。",
           
       },

       # 問題 64
       {   "question_number": 64,
           "question": "技術消込勘定はどのシナリオで転記されますか。(2つ選択)",
           "choices": ["仕入先請求書 (購買発注にリンクされていない) のある直接資産取得転記" ,"建設仮勘定に対する設備投資指図の決済" ,"資産クラス間の資産振替転記" ,"勘定設定として資産を使用した購買発注の評価入庫"],
           "answer": ["仕入先請求書 (購買発注にリンクされていない) のある直接資産取得転記" ,"勘定設定として資産を使用した購買発注の評価入庫"],
           "explanation":"技術消込勘定は直接資産取得（購買発注なし）や資産を使用した購買発注の評価入庫で使用されます。他のシナリオは対象外です。",
           
       },

       # 問題 65
       {   "question_number": 65,
           "question": "次のオブジェクトのうち、 資産に原価転記する唯一の統計勘定割当はどれですか。",
           "choices": ["WBS 要素","内部指図" ,"原価センタ" ,"利益センタ"],
           "answer": "利益センタ",
           "explanation":"資産に原価転記する唯一の統計勘定割当は利益センタです。WBS要素、内部指図、原価センタは実勘定転記も可能ですが、利益センタは統計目的のみです。",
           
       },

       # 問題 66
       {   "question_number": 66,
           "question": "臨時償却資産に転記します。 FI-AA および FI-GL にはどのような影響がありますか。",
           "choices": ["転記はリアルタイムでFI-AAに行われ、 定期記帳プログラムが実行されると FI-GL に転記が行われる。" ,"転記はリアルタイムでFI-AAに行われ、償却記帳プログラムが実行されると FI-GL に転記が行われる。" ,"転記が FI-AA および FI-GL にオンラインかつリアルタイムで行われる。" ,"償却記帳プログラムが実行されまで、 FI-AA および FI-GL に転記は実行されない。"],
           "answer": "転記はリアルタイムでFI-AAに行われ、償却記帳プログラムが実行されると FI-GL に転記が行われる。",
           "explanation":"臨時償却はFI-AAにリアルタイム転記され、FI-GLには償却記帳実行時に反映されます。FI-AAは即時反映、FI-GLはプログラム実行時反映です。",
           
       },


       # 問題 67
       {
           "question_number": 67,
           "question": "少額資産 (LVA) 管理を設定する必要があります。 必要な作業は何ですか。OLVA の最小金額を3つのレベル (会社コード、 償却領域、 資産クラス) で設定する。",
           "choices": ["LVA の最小金額を3つのレベル (会社コード、 償却領域、 資産クラス) で設定する。","個別管理で LVA の基本数量単位を定義する。","個別管理または集合管理を使用してLVA を管理するため、 2つの異なる資産クラスを定義する。","OLVA の最大金額を2つのレベル(会社コードおよび償却表) で設定する。"],
           "answer": "個別管理または集合管理を使用してLVA を管理するため、 2つの異なる資産クラスを定義する。",
           "explanation":"少額資産(LVA)は管理方法によって個別管理または集合管理で2つの異なる資産クラスを定義します。OLVAの金額設定だけでは不十分です。",
           
       },


       # 問題 68
       {   "question_number": 68,
           "question": "資産に対して償却記帳を実行します。 特定の資産について、減価償却費を資産マスタデータで指定された原価センタとは異なる原価センタに転記する必要があります。 これをどのようにして実現しますか。",
           "choices": ["LVA の最小金額を3つのレベル(会社コード、 償却領域、資産クラス) で設定する。" ,"個別管理でLVA の基本数量単位を定義する。" ,"個別管理または集合管理を使用してLVA を管理するため、 2つの異なる資産クラスを定義する。" ,"LVA の最大金額を2つのレベル(会社コードおよび償却表) で設定する。"],
           "answer": "財務会計明細で代入を登録する。",
           "explanation":"減価償却費を資産マスタ指定原価センタと異なる原価センタに転記する場合、財務会計明細で代入を登録します。特定資産だけの変更に使用されます。",
           
       },


       # 問題 69
       {   "question_number": 69,
           "question": "購買発注を参照せずに、資産取得の仕入先請求書を転記します。どの会計伝票が生成されますか。",
           "choices": ["会計原則ごとに1つの伝票" ,"会計原則ごとに個別の伝票" ,"すべての会計原則に対して1つの伝票" ,"会計原則ごとに1つの伝票、すべての会計原則に対して1つの伝票"],
           "answer": "会計原則ごとに1つの伝票、すべての会計原則に対して1つの伝票",
           "explanation":"資産取得仕入先請求書（PO参照なし）は、会計原則ごとに1つの伝票、すべての会計原則に対して1つの統合伝票が生成されます。",
           
       },
    ],
   
    "トピック 5: 決算処理": [
       # 問題 70
       {   "question_number": 70,
           "question": "決算前の活動として、選択したサプライヤが残高を確認します。 不一致がある場合にのみ応答を期待する場合、 どの確認手順を使用しますか。",
           "choices": ["残高確認書" ,"残高通知" ,"勘定報告書" ,"残高照会時に連絡文書依頼"],
           "answer": "残高通知",
           "explanation":"残高確認で不一致だけに応答を期待する場合は、残高通知を使用します。全体確認や勘定報告では用途が異なります。"
       },
       
       # 問題 71
       {   "question_number": 71,
           "question": "会社間マッチングおよび照合 (ICMR) をどのように定義しますか。(2つ選択)",
           "choices": ["セントラルファイナンスのシステム間の取引マッチングを容易にするソリューションである。" ,
                       "グループレポートと統合できるソリューションである。" ,
                       "SAP S/4HANA コアに組み込まれたソリューションである。" ,
                       "SAP Group Reporting Data Collection の並列実装を必要とする。ソリューションである。"],
           "answer": ["グループレポートと統合できるソリューションである。","SAP S/4HANA コアに組み込まれたソリューションである。"],
           "explanation":"会社コードは法的に独立した会計単位を表します。法律上の財務報告が必要な最小単位であり、複数の会社コードをまとめてグループ財務も管理可能です。事業部や営業担当単位とは異なります。",
           
       },
              
       # 問題 72
       {   "question_number": 72,
           "question": "あなたの会社では、SAP Intercompany Matching and Reconciliation(ICMR) について聞いたことがあり、ニーズに対応できるかどうか疑問に思っています。 ICMR はどの目的に役立ちますか。(2つ選択)",
           "choices": ["設定されたルールに基づいて会社間収益および原価の消去をトリガするため" ,
                       "ワークフローをトリガする会社間データの不一致を強調表示して解決するため" ,
                       "会社間不一致を修正するための自動転記を生成するため" ,
                       "会社間 AR/AP 残高の自動消去を生成するため"],
           "answer": ["ワークフローをトリガする会社間データの不一致を強調表示して解決するため","会社間不一致を修正するための自動転記を生成するため"],
           "explanation":"GLマスタは財務取引を記録する勘定を定義します。仕訳伝票作成時にどの勘定で金額を記録するかを決める、会計処理の基礎です。取引計算やレポート作成だけの機能ではありません。",
       },
       
       # 問題 73
       {   "question_number": 73,
           "question": "特別会計期間に仕訳を転記します。 次のどの条件を満たす必要がありますか。(2つ選択)",
           "choices": ["新会計年度への残高繰越が行われている必要がある。" ,
                       "転記するためには会計期間の管理で最後の会計期間をオープンする必要がある。" ,
                       "最後の会計期間に転記日付を入力する必要がある。" ,
                       "転記するためには会計期間の管理で特別会計期間をオープンする必要がある。"],
           "answer": ["最後の会計期間に転記日付を入力する必要がある。","転記するためには会計期間の管理で特別会計期間をオープンする必要がある。"],
           "explanation":"ビジネスパートナモデルでは、顧客や仕入先情報を統合して一元管理できます。重複管理を避け、データ整合性を保つことがメリットです。販売専用や会計自動化だけではありません。",
       },       
       
       # 問題 74
       {   "question_number": 74,
           "question": "会社間マッチングおよび照合ツールからのマッチング結果は、 どこで確認できますか。",
           "choices": ["連結仕訳帳テーブル (ACDOCU)" ,
                       "会計伝票セグメントテーブル (BSEG)" ,
                       "アプリケーション固有テーブル (ICADOCM)" ,
                       "ユニバーサルジャーナルテーブル (ACDOCA)"],
           "answer": "アプリケーション固有テーブル (ICADOCM)",
           "explanation":"勘定伝票は財務取引が発生したときに作成されます。現金入出金や請求書発行など、取引発生タイミングで自動または手動で伝票が生成されます。月末締めや決算時のみではありません。",
       },       
       
       # 問題 75
       {   "question_number": 75,
           "question": "外貨評価時に考慮される明細はどれですか。(2つ選択)",
           "choices": ["明細消込管理として定義されている貸借対照表勘定の明細評価" ,
                       "明細消込管理として定義されていない貸借対照表勘定の明細の残高評価" ,
                       "元帳グループ固有の明細消込管理を使用して定義された貸借対照表勘定の明細の残高評価" ,
                       "統制勘定として定義されていない貸借対照表勘定の明細評価"],
           "answer": ["明細消込管理として定義されている貸借対照表勘定の明細評価","明細消込管理として定義されていない貸借対照表勘定の明細の残高評価"],
           "explanation":"自動仕訳は定義したルールに基づき取引を自動で仕訳します。売上伝票入力時に売上勘定と売掛金勘定が自動で更新されるなど、手動入力ではなく自動化が目的です。",
           
       },       
       
       # 問題 76
       {   "question_number": 76,
           "question": "SAP S/4HANA で使用できる実地棚卸方式はどれですか。(3つ選択)",
           "choices": ["実在庫方式" ,
                       "標準在庫方式" ,
                       "継続棚卸方式" ,
                       "循環棚卸方式",
                       "定期棚卸方式"],
           "answer": ["継続棚卸方式" ,"循環棚卸方式","定期棚卸方式"],
           "explanation":"購買発注は仕入先に正式に注文を出し、注文状況や納期を管理する機能です。在庫管理や支払処理と連動します。顧客請求や会計レポート作成とは異なります。",
           
       },       
       
       # 問題 77
       {   "question_number": 77,
           "question": "SAP S/4HANA の追加元帳の説明として最も適切な文は次のどれですか。",
           "choices": ["複数の追加元帳から同じ基本元帳を参照できる。" ,
                       "追加元帳に独自の会計期間バリアントを割当できる。" ,
                       "追加元帳に独自の会計年度バリアントを割当できる。" ,
                       "追加元帳では、基本元帳とは異なる通貨を使用できる。",],
           "answer": ["複数の追加元帳から同じ基本元帳を参照できる。" ,"追加元帳に独自の会計期間バリアントを割当できる。"],
           "explanation":"在庫評価は移動平均法と先入先出法(FIFO)などで行われます。購入価格平均での評価や、先に入庫したものから出庫して評価する方法です。売上連動評価や手動評価のみではありません。",
           
       },       
       
       # 問題 78
       {   "question_number": 78,
           "question": "外貨評価における評価方法の役割は何ですか。(3つ選択)",
           "choices": ["評価転記の転記日付および反対仕訳日付を定義する。" ,
                       "評価転記の伝票タイプを定義する。" ,
                       "評価手順を定義する" ,
                       "評価転記のG/L 勘定を決定する。",
                       "換算レートタイプを決定する。"],
           "answer": ["評価転記の伝票タイプを定義する。" ,"評価手順を定義する","換算レートタイプを決定する。"],
           "explanation":"アカウント決済(Account Payable)は仕入先への支払状況を管理します。支払予定、残高、履歴を確認でき、顧客入金や在庫数量の管理は別モジュールです。",
           
       },       
       
       # 問題 79
       {   "question_number": 79,
           "question": "仕入先勘定の未消込明細に対して外貨評価を実行します。 この外貨評価は期末処理レポートのみに使用した後、 取り消す必要があります。評価差額を転記するために、 次のどの勘定が使用されますか。",
           "choices": ["仕入先統制勘定" ,
                       "特殊仕訳コードがある個別仕入先勘定" ,
                       "外貨の調整 G/L 勘定" ,
                       "代替統制勘定",],
           "answer": "外貨の調整 G/L 勘定",
          "explanation":"見積り(Quotation)は顧客に価格や納期・条件を提示する文書です。承認されれば注文につながります。請求書作成や在庫調整とは異なります。",
           
       },       
       
       # 問題 80
       {   "question_number": 80,
           "question": "会計期間バリアントを使用して転記を制限できるのは、どのレベルですか。(2つ選択)",
           "choices": ["固定資産番号" ,
                       "仕入先勘定" ,
                       "得意先統制勘定" ,
                       "G/L 勘定",],
           "answer": ["得意先統制勘定" , "G/L 勘定",],
           "explanation":"原価センターは企業内で費用が発生した場所ごとに費用を集計する単位です。部門やプロジェクト単位で費用を追跡し、効率的なコスト管理を可能にします。売上管理や財務報告単位ではありません。",
           
       },       
       
       # 問題 81
       {   "question_number": 81,
           "question": "入庫 / 請求仮勘定の貸借が一致していません。 考えられる原因として、\正しいものはどれですか。(2つ選択)",
           "choices": ["購買発注に分割請求書受領があるが、 まだ入庫がない。" ,
                       "購買発注に、まだ請求書を受領していない分割入庫がある。" ,
                       "購買発注に、同じ数量と金額の入庫と請求書受領がある。" ,
                       "購買発注に、数量が同じで金額が異なる入庫と請求書受領がある。",],
           "answer": ["購買発注に分割請求書受領があるが、 まだ入庫がない。" , "購買発注に、まだ請求書を受領していない分割入庫がある。",],
           "explanation":"プロフィットセンターは利益を部門や製品ごとに分析する単位です。収益と費用の両方を集計し、利益貢献度を評価します。費用管理だけではなく、在庫管理とは無関係です。",
       },       
       
       # 問題 82
       {   "question_number": 82,
           "question": "財務諸表レポートを実行すると、計算された純利益が予想と異なることがわかりました。 問題の原因は何ですか。(2つ選択)",
           "choices": ["勘定の残高による勘定グループ割当を選択し、それが負債として表示されている" ,
                       "財務諸表注記に属する負債ノードに勘定を追加した。" ,
                       "財務諸表バージョンに割り当てられていない勘定がある。" ,
                       "間違ったノードに勘定を追加し、 それが資産セクションに含まれている",],
           "answer": ["財務諸表注記に属する負債ノードに勘定を追加した。" , "財務諸表バージョンに割り当てられていない勘定がある。",],
           "explanation":"勘定伝票の仕訳日付は、取引を帳簿上いつ記録するかを示す日付です。取引日や会計期間に応じて、正しい期間に費用や収益を計上できます。伝票番号や支払日とは異なります。",
       },       
       
       # 問題 83
       {   "question_number": 83,
           "question": "SAP S/4HANA の見越/繰延エンジンの機能および特徴は次のどれですか。(2つ選択)",
           "choices": ["総勘定元帳のすべての通貨がサポートされる。" ,
                       "最大2つの明細がある見越 / 繰延転記がサポートされる。" ,
                       "転記前に、すべての見越/ 繰延計算をレビューおよび承認する必要がある。" ,
                       "総勘定元帳の会計年度バリアントがサポートされる。",],
           "answer": ["総勘定元帳のすべての通貨がサポートされる。" , "総勘定元帳の会計年度バリアントがサポートされる。",],
           "explanation":"減価償却は固定資産の購入コストを使用期間にわたって費用配分する処理です。会計期間ごとの費用を正確に反映する目的で行われます。現金支払いや在庫評価とは別の処理です。",
           
       },       
       
       # 問題 84
       {   "question_number": 84,
           "question": "外貨評価の実行時に、関連する会計原則はどのように決定されますか。",
           "choices": ["評価方法によって" ,
                       "評価クラスによって" ,
                       "評価タイプによって" ,
                       "評価領域によって",],
           "answer": "評価領域によって",
           "explanation":"内部オーダーは特定プロジェクトや業務のコストを追跡する単位です。修理やプロジェクトなどの費用を詳細に集計・管理でき、売上管理や財務報告単位とは異なります。",
           
       },       
       
       # 問題 85
       {   "question_number": 85,
           "question": "組織に決算処理コックピットを導入しています。 タスクグループを定義する利点は何ですか。(2つ選択)",
           "choices": ["テンプレート全体の更新が可能である。" ,
                       "同一または類似のタスクのある複数の会社コードに対応する。" ,
                       "タスクステータスのタスクリスト間監視が可能である。" ,
                       "タスクのタスクリスト間実行が可能である。"],
           "answer": ["テンプレート全体の更新が可能である。" ,"同一または類似のタスクのある複数の会社コードに対応する。" ],
           "explanation":"トランザクションコード(T-code)はSAP内で特定の業務処理や画面を呼び出すショートカットコードです。GUI操作を省略して直接画面を開ける便利な仕組みで、伝票番号や会計科目とは異なります。"
           
       },          
    ],
    
    "トピック 6: SAP S/4HANA の概要および導入": [
       # 問題 86
       {   "question_number": 86,
           "question": "顧客が SAP およびパートナの垂直型ソリューションを見つけてデプロイできるようにする、インテリジェントエンタープライズのコンポーネントはどれですか。",
           "choices": ["エクスペリエンス管理" ,
                       "ビジネスネットワーク" ,
                       "業種別クラウド" ,
                       "インテリジェントスイート",],
           "answer": "業種別クラウド" ,
           "explanation":"業種別クラウドは特定業界向けにパッケージ化された SAP ソリューションです。顧客は自社業務に合ったソリューションを簡単に見つけて導入できます。エクスペリエンス管理やビジネスネットワーク、インテリジェントスイートは個別の機能で導入支援は含まれません。",
           
       },       
       
       # 問題 87
       {   "question_number": 87,
           "question": "SAP HANA の主要な機能/特徴は何ですか。(2つ選択)",
           "choices": ["SAP HANA では、同じテーブルから取引処理と分析処理を実行できる。" ,
                       "SAP HANA は、カラムストアを使用してデータを整理するように最適化されている。" ,
                       "SAP HANA は、階層データモデルアーキテクチャに基づいて構築されている。" ,
                       "SAP HANA は、集計と索引が使用できるよう最適化されている。",],
           "answer": ["SAP HANA では、同じテーブルから取引処理と分析処理を実行できる。" ,"SAP HANA は、カラムストアを使用してデータを整理するように最適化されている。" ],
           "explanation":"SAP HANA の特徴は、同じテーブルで取引処理と分析処理が可能なことと、カラムストアに最適化されていることです。これによりリアルタイム集計と高速分析が可能になります。階層データモデルや集計・索引最適化は限定的説明です。",
           
       },       
       
       # 問題 88
       {   "question_number": 88,
           "question": "SAP Business Technology Platform にはどのような機能がありますか。(2つ選択)",
           "choices": ["顧客がステークホルダのニーズを理解するのをサポートする。" ,
                       "顧客が協働して柔軟なバリューチェーンを構築するのに役立つ。" ,
                       "アプリケーション開発および統合がサポートされる。" ,
                       "データ管理および分析が提供される。",],
           "answer": ["アプリケーション開発および統合がサポートされる。" ,"データ管理および分析が提供される。" ],
           "explanation":"SAP BTP はアプリ開発・統合、データ管理・分析機能を提供します。クラウド上でシステム間統合やアプリ開発をサポートする基盤です。ステークホルダの理解や業務プロセス構築は直接の技術機能ではありません。",
           
       },       
       
       # 問題 89
       {   "question_number": 89,
           "question": "任意のデータベース上で実行できるSAP Fiori アプリはどれですか。(2つ選択)",
           "choices": ["銀行振込実行" ,
                       "勘定コード表管理" ,
                       "債務概要。" ,
                       "得意先会計伝票",],
           "answer": ["銀行振込実行" ,"勘定コード表管理" ],
           "explanation":"任意のデータベース上で実行できる Fiori アプリは、銀行振込実行や勘定コード表管理です。これらは HANA 固有の高速集計を必要とせず、ABAP ベースでどの DB でも動作します。債務概要や得意先会計伝票は HANA 前提です。",
           
       },       
       
       # 問題 90
       {   "question_number": 90,
           "question": "SAP S/4HANA でのデータ処理の利点は何ですか。(2つ選択)",
           "choices": ["明細詳細でデータをリアルタイムで利用できる。" ,
                       "メモリ使用を最適化するために、データが常に自動アーカイブされる" ,
                       "任意の明細テーブルからデータがリアルタイムで集計される。" ,
                       "システムのパフォーマンスを向上させるために、データが上位レベルに集約される。",],
           "answer": ["明細詳細でデータをリアルタイムで利用できる。" ,"任意の明細テーブルからデータがリアルタイムで集計される。" ],
           "explanation":"ユニバーサルジャーナルは FI と CO のデータを単一テーブルに統合し、複数会計コンポーネントのデータを同時に処理できます。これにより帳簿が統一され、手動集計や業種限定ではありません。",
           
       },       
       
       # 問題 90
       {   "question_number": 90,
           "question": "SAP S/4HANA でのデータ処理の利点は何ですか。(2つ選択)",
           "choices": ["明細詳細でデータをリアルタイムで利用できる。" ,
                       "メモリ使用を最適化するために、データが常に自動アーカイブされる" ,
                       "任意の明細テーブルからデータがリアルタイムで集計される。" ,
                       "システムのパフォーマンスを向上させるために、データが上位レベルに集約される。",],
           "answer": ["明細詳細でデータをリアルタイムで利用できる。" ,"任意の明細テーブルからデータがリアルタイムで集計される。" ],
           "explanation":"マルチカレンシー機能は複数通貨での会計処理と報告を可能にします。為替レートに基づき自動換算され、固定通貨や為替無視は間違いです。",
       },       
       
       # 問題 91
       {   "question_number": 91,
           "question": "SAP Fiori ラウンチパッドでは、ページはどのようにユーザに割り当てられますか。",
           "choices": ["ユーザに割り当てられているビジネスロールに割り当てられたセクションを使用する。" ,
                       "ユーザに割り当てられているビジネスロールに直接割り当てる。" ,
                       "ユーザに割り当てられているビジネスロールに割り当てられたグループを使用する。" ,
                       "ユーザに割り当てられているビジネスロールに割り当てられたスペースを使用する。",],
           "answer": ["ユーザに割り当てられているビジネスロールに割り当てられたスペースを使用する。" ],
           "explanation":"マルチカレンシー機能は複数通貨での会計処理と報告を可能にします。為替レートに基づき自動換算され、固定通貨や為替無視は間違いです。",
       },       
       
       # 問題 92
       {   "question_number": 92,
           "question": "あなたは、北米のビジネスマーケットに関心があるグループ資金管理者です。 SAP Fiori で利用できるパーソナライゼーションオプションは何ですか。(2つ選択)",
           "choices": ["簡単にアクセスできるよう、日常業務で必要なすべてのアプリが含まれたタイルグループを登録できる。" ,
                       "管理者のサポートを受けずに、チームの関連アプリへのユーザアクセスを管理できる。" ,
                       "北米のビジネスマーケットのキャッシュポジションに直接アクセスできるタイルを登録できる。" ,
                       "資金レポートの事前定義済み値に従って、 ラウンチパッドのカラーテーマを調整できる。"],
           "answer": ["簡単にアクセスできるよう、日常業務で必要なすべてのアプリが含まれたタイルグループを登録できる。","北米のビジネスマーケットのキャッシュポジションに直接アクセスできるタイルを登録できる。" ],
           "explanation":"Fiori アプリはモバイルフレンドリーで、役割ベースの画面設計が特徴です。ユーザーの職務に応じて必要情報だけ表示され、従来の SAP GUI や複雑なカスタムプログラムは不要です。",
           
       },       
       
       # 問題 93
       {   "question_number": 93,
           "question": "SAP Business Network は、 得意先が会社間ビジネスプロセスをデジタル化するのに役立ちます。 ネットワークによって構築されるソリューションはどれですか。(3つ選択)",
           "choices": ["非正規社員" ,
                       "人材管理" ,
                       "調達" ,
                       "旅費",
                       "販売"],
           "answer": ["非正規社員","調達","旅費" ],
           "explanation":"BTP の統合機能は異なるアプリやシステム間でデータを連携し、統一された業務プロセスを実現します。単にデータ保管や分析専用ではありません。",
           
       },    
    ],    
          
    "トピック 7: Clean Core の管理": [
       # 問題 94
       {   "question_number": 94,
           "question": "次のうち、Clear Core 統合を実現するために SAP が使用を推奨するAPI タイプはどれですか。(2つ選択)",
           "choices": ["IDoc" ,
                       "OData",
                       "RFC" ,
                       "SOAP"],                       
           "answer": ["OData","SOAP" ],
           "explanation":"SAP Analytics Cloud はデータの可視化と予測分析機能を提供します。取引処理やアプリ開発は目的外です。",
           
       },       
       
       # 問題 95
       {   "question_number": 95,
           "question": "あなたは SAP S/4HANA Cloud ブラウンフィールドプロジェクトのコンサルタントです。 ミーティングで、顧客は Clean Core の原則に従って既存のビジネスモデルを再モデリングすることを決定しました。次のうち、再モデリングに使用できる SAP Signavio ソリューションはどれですか。",
           "choices": ["AP Signavio Process Manager" ,
                       "SAP Signavio Process Governance" ,
                       "SAP Signavio Process Intelligence" ,
                       "SAP Signavio Process Insights"],                       
           "answer": "AP Signavio Process Manager" ,
           "explanation":"S/4HANA の在庫管理では、在庫数量と評価をリアルタイムで管理し、受注・出荷と連動して更新されます。手動集計や分析専用ではありません。",
           
       },       
       
       # 問題 96
       {   "question_number": 96,
           "question": "Clean Core の運用を実現するために SAP が推奨する原則は何ですか。(3つ選択)",
           "choices": ["プロセス変革オフィスの一環として、役割と責任を定義する。" ,
                       "Clean Core プラクティスをエンドツーエンドのバリュープロセスチェーンに統合する。" ,
                       "定期的なハウスキーピングタスクおよび手順を確立する。" ,
                       "リリース管理を確立する。",
                       "Clean Core の組織構造、 技術基盤、 および変革手法を確立する。"],                       
           "answer": ["Clean Core プラクティスをエンドツーエンドのバリュープロセスチェーンに統合する。" ,
                       "定期的なハウスキーピングタスクおよび手順を確立する。" ,
                       "リリース管理を確立する。"],
           "explanation":"購買業務では、自動発注提案と受注・発注のトレーサビリティが重要です。会計自動化や顧客体験改善は直接の機能ではありません。",
           
       },       
       
       # 問題 97
       {   "question_number": 97,
           "question": "あなたは SAP S/4HANA Cloud グリーンフィールドプロジェクトのコンサルタントです。 次のうち、 Clean Core のデータ品質を達成して維持するために重点を置く必要がある側面はどれですか。(2つ選択)",
           "choices": ["正確性" ,
                       "効率性" ,
                       "適時性" ,
                       "安定性"],                       
           "answer": ["正確性" ,"適時性"],
           "explanation":"Fiori のタイルは、業務アクションや情報へのアクセスを簡単に行うボタン状の UI 要素です。伝統的メニューやデータベーステーブルとは別物です。",
           
       },       
       
       # 問題 98
       {   "question_number": 98,
           "question": "あなたは SAP S/4HANA Cloud グリーンフィールドプロジェクトのコンサルタントです。 Clean Core ジャーニーの一環として、顧客は現在のIT ランドスケープを分析して冗長なシステムを排除し、 効率的なアーキテクチャ設計を確立する必要があります。 次のうち、 分析に使用できるものはどれですか。",
           "choices": ["Lean IX" ,
                       "SAP Solution Manager" ,
                       "SAP Best Practices" ,
                       "SAP Cloud ALM"],                       
           "answer": "Lean IX",
           "explanation":"販売業務でリアルタイムに確認できるのは受注状況と請求情報です。過去データのみや分析専用ではなく、日常業務でも即時反映されます。",
       },       

       # 問題 99
       {   "question_number": 99,
           "question": "ABAP クラウドネイティブ開発に使用できるモデルはどれですか。",
           "choices": ["ABAP Cloud 開発モデル" ,
                       "SAP S/4HANA Cloud 拡張性モデル" ,
                       "ABAP RESTful アプリケーションプログラミングモデル" ],                       
           "answer": "ABAP Cloud 開発モデル",
           "explanation":"BTP の拡張機能は標準機能を変更せず、独自の業務ロジックや UI を追加することが目的です。標準を書き換えたり分析専用ではありません。",
       },       

       # 問題 100
       {   "question_number": 100,
           "question": "次のうち、リリース済 API を調べるために使用できるものはどれですか。",
           "choices": ["SAP Application Interface Framework" ,
                       "SAP Integration Suite" ,
                       "SAP Business Accelerator Hub"],                       
           "answer": "SAP Business Accelerator Hub",
           "explanation":"リアルタイム財務は取引発生時に即時会計情報を更新し、常に最新の財務状況を把握できることを意味します。従来の日次・月次更新や手動集計ではありません。"
       },       
    ]     
}
# ===== トップページ =====
@app.route('/')
def index():
    topics = list(quiz_data.keys())
    progress = session.get("index", 0)
    total = session.get("total", 0)
    return render_template('index.html', topics=topics, progress=progress, total=total)

# ===== クイズ開始 =====
@app.route('/start', methods=['POST'])
def start():
    selected_topics = request.form.getlist('topics')
    shuffle_questions = 'shuffle_questions' in request.form
    shuffle_choices = 'shuffle' in request.form

    if not selected_topics:
        return render_template(
            'index.html',
            topics=list(quiz_data.keys()),
            error="少なくとも1つ選択してください"
        )


    # 複数トピックの問題をまとめる
    questions = []
    for topic in selected_topics:
        if topic in quiz_data:
            for i, q in enumerate(quiz_data[topic]):
                questions.append((topic, i))
                
                
 # 問題シャッフル
    if shuffle_questions:
        random.shuffle(questions)

    session['selected_topics'] = selected_topics
    session['index'] = 0
    session['score'] = 0
    session['questions'] = questions
    session['shuffle_choices'] = shuffle_choices

    return redirect(url_for('quiz'))

# ===== 共通関数: 選択トピックの問題取得 =====
def get_selected_questions():
    selected_topics = session.get('selected_topics', [])
    questions = []
    for topic in selected_topics:
        questions.extend(quiz_data.get(topic, []))
    if session.get("shuffle_questions", False):
        random.shuffle(questions)
    return questions

# ===== 問題表示 =====
@app.route('/quiz')
def quiz():
    index = session.get("index", 0)
    questions = session.get("questions", [])
    total = len(questions)
    session['total'] = total  # トータル数を保存

    if total == 0 or index >= total:
        return redirect(url_for('final_result'))

    topic, q_index = questions[index]   # ← tuple を展開
    question = quiz_data[topic][q_index]
    
    choices = question["choices"][:]
    if session.get("shuffle_choices", True):
        random.shuffle(choices)

    # 出題時の choices を保存
    session['current_choices'] = choices

    is_multiple = isinstance(question["answer"], list)

    return render_template(
        'quiz.html',
        question=question,
        choices=choices,
        is_multiple=is_multiple,
        current=index + 1,
        total=total
    )

# ===== 回答チェック =====
@app.route('/check', methods=['POST'])
def check():
    index = session.get("index", 0)
    questions = session.get("questions", [])
    total = len(questions)

    if total == 0 or index >= total:
        return redirect(url_for('final_result'))
    
    topic, q_index = questions[index]
    question = quiz_data[topic][q_index]
    
    selected = request.form.getlist('choice')
    correct_answer = question["answer"]
    
    if isinstance(correct_answer, list):
        is_correct = set(selected) == set(correct_answer)
    else:
        is_correct = selected == [correct_answer]
        
    # ===== 正誤をセッションに保存 =====
    answered = session.get("answered_questions", {})
    key = f"{topic}|{q_index}"  
    answered[key] = is_correct
    session["answered_questions"] = answered
    
    
    # 全体スコア更新
    if is_correct:
        session["score"] = session.get("score", 0) + 1

    # 出題時の choices を再利用
    choices = session.get("current_choices", question["choices"])

    return render_template(
        'result.html',
        is_correct=is_correct,
        selected=selected,
        answer=correct_answer,
        question=question,
        choices=choices
    )
        
# ===== 次の問題へ =====
@app.route('/next')
def next_question():
    index = session.get("index", 0) + 1
    questions = session.get("questions", [])
    total = len(questions)

    if index >= total:
        return redirect(url_for('final_result'))

    session["index"] = index
    return redirect(url_for('quiz'))

# ===== 最終結果 =====
@app.route('/final_result')
def final_result():
    score = session.get("score", 0)
    total = session.get("total", 0)
    
    # 過去の回答をセッションから取得
    answered = session.get("answered_questions", {})  # {(topic, q_index): True/False}
    
    # 全問題リストをセッションから取得
    questions = session.get("questions", [])

    # トピック別集計
    topic_scores = {}
    for topic, q_index in questions:
        if topic not in topic_scores:
             topic_scores[topic] = {"correct": 0, "incorrect": 0}
    
        key = f"{topic}|{q_index}"
        is_correct = answered.get(key, False)  # True / False / None
    
        if is_correct:
            topic_scores[topic]["correct"] += 1
        else:
            # 不正解 or 未回答も不正解扱い
            topic_scores[topic]["incorrect"] += 1
            
    return render_template(
        'final_result.html',
        score=score,
        total=total,
        topic_scores=topic_scores
    )
    
# ===== 中断 =====
@app.route('/abort', methods=['POST'])
def abort():
    return redirect(url_for('index'))

if __name__ == "__main__":
    app.run(debug=True)